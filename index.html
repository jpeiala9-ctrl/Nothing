<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RI5 ¬∑ NOTHING EDITION</title>
  
  <!-- MANIFEST (estilo Nothing) -->
  <link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22RI5%20%C2%B7%20NOTHING%22%2C%22short_name%22%3A%22RI5%22%2C%22description%22%3A%22Entrenamiento%20runner%20con%20zonas%2C%20planes%20y%20soporte%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23000000%22%2C%22theme_color%22%3A%22%23ffffff%22%2C%22orientation%22%3A%22portrait%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%20100%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23000000%22%2F%3E%3Ctext%20x%3D%2250%22%20y%3D%2268%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20fill%3D%22%23ffffff%22%20font-family%3D%22Arial%22%3ERI5%3C%2Ftext%3E%3C%2Fsvg%3E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%2C%7B%22src%22%3A%22data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%20100%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23000000%22%2F%3E%3Ctext%20x%3D%2250%22%20y%3D%2268%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20fill%3D%22%23ffffff%22%20font-family%3D%22Arial%22%3ERI5%3C%2Ftext%3E%3C%2Fsvg%3E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%5D%7D">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="RI5">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%20100%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23000000%22%2F%3E%3Ctext%20x%3D%2250%22%20y%3D%2268%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20fill%3D%22%23ffffff%22%20font-family%3D%22Arial%22%3ERI5%3C%2Ftext%3E%3C%2Fsvg%3E">

  <style>
    /* ===== RESET Y VARIABLES NOTHING ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #000000;
      --bg-secondary: #111111;
      --bg-card: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --accent-red: #ff4530;
      --accent-green: #32d74b;
      --accent-blue: #0a84ff;
      --accent-yellow: #ffd60a;
      --accent-purple: #bf5af2;
      --border-color: #333333;
      --glow-color: rgba(255, 255, 255, 0.1);
      --font-mono: 'Courier New', monospace;
      --font-dot: 'Courier New', 'Dot Matrix', monospace;
      --dot-color: rgba(255, 255, 255, 0.05);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg-primary: #f5f5f5;
        --bg-secondary: #e5e5e5;
        --bg-card: #ffffff;
        --text-primary: #111111;
        --text-secondary: #333333;
        --border-color: #cccccc;
        --glow-color: rgba(0, 0, 0, 0.1);
        --dot-color: rgba(0, 0, 0, 0.05);
      }
      input, button, select { color: #111111; }
      .curiosity span, .curiosity small { color: #111111; }
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font-mono);
      line-height: 1.6;
      letter-spacing: 0.5px;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: repeating-radial-gradient(circle at 20px 20px, var(--dot-color) 2px, transparent 2px, transparent 10px);
      background-size: 30px 30px;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.5;
    }

    h1, h2, h3, h4 {
      font-family: var(--font-dot);
      font-weight: 300;
      letter-spacing: 2px;
      text-transform: uppercase;
      position: relative;
      display: inline-block;
    }
    h1::after, h2::after {
      content: "";
      position: absolute;
      bottom: -5px; left: 0;
      width: 100%; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
    }

    .wrapper {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      overflow-y: auto;
    }

    #loginPage.wrapper {
      align-items: flex-start;
      padding-top: 20px;
      padding-bottom: 20px;
    }

    .card {
      width: 100%;
      max-width: 540px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 32px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), inset 0 0 20px var(--glow-color);
      position: relative;
      overflow: hidden;
      margin: 20px 0;
    }
    .card::before {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-radial-gradient(circle at 20px 20px, var(--dot-color) 2px, transparent 2px, transparent 10px);
      background-size: 30px 30px;
      opacity: 0.3;
      pointer-events: none;
    }

    .card.admin-card {
      max-width: 800px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .card.admin-card .tabs-container {
      flex: 1;
      overflow-y: auto;
      padding-right: 5px;
    }

    .card::after {
      content: "";
      position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      background: linear-gradient(45deg, var(--accent-red), var(--accent-green), var(--accent-blue), var(--accent-purple));
      border-radius: 34px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    .card:hover::after { opacity: 0.2; }

    /* ===== HEADER CON CERRAR SESI√ìN ===== */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .logout-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--accent-red);
      border-radius: 40px;
      color: var(--accent-red);
      font-family: var(--font-mono);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
      text-align: center;
    }
    .logout-btn:hover {
      background: var(--accent-red);
      color: var(--bg-primary);
    }

    /* ===== TABS DE LOGIN/REGISTRO ===== */
    .auth-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 30px;
      background: var(--bg-secondary);
      padding: 4px;
      border-radius: 40px;
      border: 1px solid var(--border-color);
    }
    .auth-tab {
      flex: 1;
      padding: 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-family: var(--font-dot);
      font-size: 14px;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 30px;
    }
    .auth-tab.active {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      box-shadow: inset 0 0 20px var(--glow-color);
    }
    .auth-form { display: none; animation: glyphIn 0.5s ease; }
    .auth-form.active { display: block; }

    /* ===== PESTA√ëAS PRINCIPALES ===== */
    .tabs-container { margin: 30px 0; }
    .tabs-header {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 20px;
      background: var(--bg-secondary);
      padding: 4px;
      border-radius: 40px;
      border: 1px solid var(--border-color);
    }
    .tab-button {
      flex: 1;
      min-width: 70px;
      max-width: 100px;
      padding: 12px 4px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-family: var(--font-dot);
      font-size: 13px;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 30px;
      position: relative;
      overflow: visible;
      white-space: nowrap;
    }
    .tab-button::before {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 0; height: 0;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.3s ease, height 0.3s ease;
    }
    .tab-button:hover::before { width: 200px; height: 200px; }
    .tab-button.active {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      box-shadow: inset 0 0 20px var(--glow-color);
    }
    .tab-content { display: none; animation: glyphIn 0.5s ease; }
    .tab-content.active { display: block; }
    @keyframes glyphIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== INPUTS Y SELECTS ===== */
    input, button, select {
      width: 100%;
      padding: 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 40px;
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: 16px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      outline: none;
    }
    input:focus, select:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 20px rgba(10, 132, 255, 0.5);
    }
    input::placeholder {
      color: var(--text-secondary);
      font-family: var(--font-mono);
      letter-spacing: 1px;
    }
    input.error { border-color: var(--accent-red); }

    .fecha-inicio-container {
      text-align: center;
      margin: 20px 0 10px;
    }
    .fecha-inicio-container label {
      display: block;
      margin-bottom: 8px;
      color: var(--accent-yellow);
      font-family: var(--font-dot);
      font-size: 14px;
      letter-spacing: 1px;
    }
    #fechaInicio {
      max-width: 300px;
      margin: 0 auto;
      text-align: center;
    }

    .button-main {
      background: transparent;
      border: 1px solid var(--accent-blue);
      color: var(--accent-blue);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      width: auto;
      min-width: 180px;
      margin: 20px auto !important;
      display: block;
      text-align: center;
    }
    .button-main::before {
      content: "";
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(10, 132, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }
    .button-main:hover::before { left: 100%; }
    .button-main:hover { box-shadow: 0 0 30px rgba(10, 132, 255, 0.4); }
    .button-main:disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }

    .requestCodeBtn {
      background: transparent;
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
      text-decoration: none;
      display: inline-block;
      padding: 12px 24px;
      border-radius: 40px;
      margin-top: 12px;
      transition: all 0.3s ease;
      cursor: pointer;
      margin: 12px auto 0;
      display: block;
      width: fit-content;
    }
    .requestCodeBtn:hover { box-shadow: 0 0 30px rgba(50, 215, 75, 0.4); }

    /* ===== TARJETA DE INFORMACI√ìN ===== */
    .info-card {
      margin: 30px 0;
      padding: 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .info-card .title {
      font-family: var(--font-dot);
      font-size: 18px;
      letter-spacing: 2px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .info-card .subtitle {
      color: var(--text-secondary);
      font-size: 12px;
      margin-bottom: 16px;
      text-align: center;
    }
    .info-card .content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
      opacity: 0;
    }
    .info-card.active .content {
      max-height: 600px;
      overflow-y: auto;
      opacity: 1;
      padding-right: 10px;
    }
    .feature-section {
      margin: 20px 0;
      padding: 16px;
      background: var(--bg-primary);
      border-radius: 16px;
      border: 1px solid var(--border-color);
    }
    .feature-section h4 { color: var(--accent-blue); margin-bottom: 12px; font-size: 14px; }
    .feature-section ul { list-style: none; }
    .feature-section li {
      margin: 12px 0;
      padding: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px dashed var(--border-color);
    }
    .feature-icon { font-size: 20px; min-width: 30px; }

    /* ===== CURIOSIDAD ===== */
    .curiosity {
      margin: 30px 0;
      padding: 30px;
      background: var(--bg-secondary);
      border: 1px solid var(--accent-purple);
      border-radius: 24px;
      text-align: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .curiosity::before {
      content: "";
      position: absolute;
      top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle, rgba(191, 90, 242, 0.25) 0%, transparent 70%);
      animation: pulse 4s linear infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.2); opacity: 0.2; }
      100% { transform: scale(1); opacity: 0.5; }
    }
    .curiosity span { font-size: 18px; line-height: 1.5; position: relative; z-index: 1; }
    .curiosity small { display: block; color: var(--text-secondary); margin-top: 12px; font-size: 12px; }

    /* ===== ZONAS DE ENTRENAMIENTO ===== */
    .zone-card {
      margin: 16px 0;
      padding: 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .zone-card::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 4px; height: 100%;
      transition: all 0.3s ease;
    }
    .zone-card:hover { transform: translateX(5px); }
    .z1::after { background: var(--accent-blue); }
    .z2::after { background: var(--accent-green); }
    .z3::after { background: var(--accent-yellow); }
    .z4::after { background: var(--accent-red); }
    .z5::after { background: var(--accent-purple); }
    .z6::after { background: var(--accent-blue); }

    .zone-card .long {
      max-height: 0;
      overflow: hidden;
      transition: all 0.5s ease;
      margin-top: 0;
      color: var(--text-secondary);
      font-size: 14px;
    }
    .zone-card.active .long {
      max-height: 300px;
      margin-top: 16px;
    }

    .pred-bar {
      height: 30px;
      border-radius: 40px;
      margin: 8px 0;
      padding: 0 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      font-size: 14px;
    }

    /* ===== CALENDARIO ===== */
    #calendarioEntreno {
      margin: 30px 0;
      padding: 20px;
      background: var(--bg-secondary);
      border-radius: 24px;
      width: 100%;
    }
    .calendar-grid-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
      margin-bottom: 8px;
      width: 100%;
    }
    .calendar-header div {
      text-align: center;
      color: var(--text-secondary);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 5px 0;
      white-space: nowrap;
    }
    #calendarioGrid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
      width: 100%;
    }
    .calendario-dia {
      aspect-ratio: 1 / 1;
      padding: 4px 2px;
      background: var(--bg-primary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 11px;
      width: 100%;
      min-width: 0;
      overflow: hidden;
      position: relative;
      z-index: 1;
      white-space: normal;
      word-break: break-word;
      line-height: 1.2;
    }
    .calendario-dia:hover {
      border-color: var(--accent-blue);
      transform: scale(1.05);
      z-index: 5;
      box-shadow: 0 0 15px rgba(10, 132, 255, 0.6);
    }
    .sesion-descanso { border-color: var(--border-color); background: var(--bg-secondary); }
    .sesion-rodaje { border-color: var(--accent-blue); background: #0a1a2a; }
    .sesion-series { border-color: var(--accent-green); background: #0a2a0a; }
    .sesion-tempo { border-color: var(--accent-yellow); background: #2a2a0a; }
    .sesion-largo { border-color: var(--accent-red); background: #2a0a0a; }

    /* Forzar texto blanco en celdas de sesi√≥n */
    .calendario-dia.sesion-rodaje,
    .calendario-dia.sesion-series,
    .calendario-dia.sesion-tempo,
    .calendario-dia.sesion-largo {
      color: #ffffff !important;
    }

    /* ===== BOTONES DE ACCI√ìN ===== */
    .action-button {
      padding: 16px;
      margin: 8px 0;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 40px;
      color: var(--text-primary);
      font-weight: 600;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      text-align: center;
    }
    .action-button:hover {
      border-color: var(--accent-blue);
      box-shadow: 0 0 30px rgba(10, 132, 255, 0.3);
    }
    .btn-copy { border-color: var(--accent-blue); }
    .btn-save { border-color: var(--accent-green); }
    .btn-delete { border-color: var(--accent-red); }
    .btn-plan { border-color: var(--accent-yellow); }
    .btn-view { border-color: var(--accent-purple); }

    /* ===== HISTORIAL ===== */
    .historial-list { display: flex; flex-direction: column; gap: 12px; }
    .historial-item {
      padding: 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      position: relative;
      text-align: left;
    }
    .historial-item .fecha {
      color: var(--accent-blue);
      font-family: var(--font-dot);
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding-right: 70px;
    }
    .historial-item .fecha .fecha-linea {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .historial-item .hora {
      color: var(--accent-green);
      font-size: 12px;
      background: rgba(50, 215, 75, 0.2);
      padding: 2px 8px;
      border-radius: 20px;
      display: inline-block;
      width: fit-content;
    }
    .historial-item .resumen {
      color: var(--text-secondary);
      font-size: 12px;
      margin-right: 60px;
      white-space: pre-wrap;
    }
    .historial-item .predicciones {
      color: var(--accent-blue);
      font-size: 11px;
      margin: 4px 0;
      background: rgba(10, 132, 255, 0.1);
      padding: 2px 6px;
      border-radius: 12px;
      display: inline-block;
    }
    .historial-item .zonas-resumen {
      color: var(--accent-purple);
      font-size: 11px;
      margin: 4px 0;
      border-top: 1px dashed var(--border-color);
      padding-top: 4px;
    }
    .historial-item .delete-single {
      position: absolute;
      top: 16px;
      right: 16px;
      background: transparent;
      border: 1px solid var(--accent-red);
      border-radius: 40px;
      color: var(--accent-red);
      padding: 4px 12px;
      font-size: 10px;
      cursor: pointer;
      width: auto;
      margin: 0;
      z-index: 2;
    }
    .historial-item .delete-single:hover { background: var(--accent-red); color: var(--bg-primary); }

    /* ===== MENSAJES ===== */
    .mensaje-item {
      margin-bottom: 10px;
      border-left: 4px solid var(--accent-blue);
      background: var(--bg-secondary);
      border-radius: 16px;
      overflow: hidden;
      position: relative;
    }
    .mensaje-item .mensaje-header {
      padding: 16px;
      padding-right: 80px;
      background: var(--bg-primary);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      color: var(--accent-blue);
      transition: background 0.2s;
      position: relative;
    }
    .mensaje-item .mensaje-header:hover {
      background: var(--bg-card);
    }
    .mensaje-item .mensaje-header span:first-child {
      font-size: 14px;
    }
    .mensaje-item .mensaje-header .flecha {
      font-size: 16px;
      transition: transform 0.3s;
      margin-left: auto;
      margin-right: 40px;
    }
    .mensaje-item .mensaje-contenido {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
      padding: 0 16px;
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.5;
      background: var(--bg-secondary);
    }
    .mensaje-item.abierto .mensaje-contenido {
      max-height: 200px;
      padding: 16px;
    }
    .mensaje-item.abierto .flecha {
      transform: rotate(180deg);
    }
    .mensaje-item.nuevo .mensaje-header {
      border-left: 4px solid var(--accent-red);
    }
    .delete-mensaje {
      position: absolute;
      top: 50%;
      right: 16px;
      transform: translateY(-50%);
      background: transparent;
      border: 1px solid var(--accent-red);
      border-radius: 40px;
      color: var(--accent-red);
      padding: 4px 8px;
      font-size: 10px;
      cursor: pointer;
      z-index: 3;
    }
    .delete-mensaje:hover {
      background: var(--accent-red);
      color: var(--bg-primary);
    }

    .soporte-section {
      margin-top: 30px;
    }
    .soporte-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 20px;
      background: var(--bg-secondary);
      padding: 4px;
      border-radius: 40px;
      border: 1px solid var(--border-color);
    }
    .soporte-tab {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-family: var(--font-dot);
      font-size: 13px;
      cursor: pointer;
      border-radius: 30px;
      transition: all 0.3s;
    }
    .soporte-tab.active {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }
    .soporte-panel {
      display: none;
    }
    .soporte-panel.active {
      display: block;
    }

    /* ===== BADGE DE MENSAJES NO LE√çDOS ===== */
    .unread-badge {
      display: inline-block;
      background: var(--accent-red);
      color: var(--text-primary);
      border-radius: 20px;
      padding: 2px 6px;
      font-size: 10px;
      font-weight: bold;
      margin-left: 5px;
      vertical-align: middle;
      line-height: 1;
      animation: parpadeo 1.5s infinite;
    }
    @keyframes parpadeo {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    /* ===== ADMIN PANEL ===== */
    .admin-panel { margin: 30px 0; padding: 20px; background: var(--bg-secondary); border-radius: 24px; }
    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    .stat-card {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      text-align: center;
    }
    .stat-card .number { font-size: 24px; color: var(--accent-blue); font-weight: bold; }
    .stat-card .label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; }
    .admin-search { margin: 20px 0; }
    .admin-search input { margin-bottom: 0; }

    /* Contenedor con scroll para la tabla de usuarios */
    .admin-table-container {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: 16px;
      background: var(--bg-primary);
      margin: 20px 0;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }
    .admin-table th {
      position: sticky;
      top: 0;
      background: var(--bg-secondary);
      text-align: left; padding: 12px 8px;
      color: var(--accent-blue); font-family: var(--font-dot); font-size: 12px;
      text-transform: uppercase; letter-spacing: 1px;
      border-bottom: 1px solid var(--border-color);
      z-index: 2;
    }
    .admin-table td { padding: 12px 8px; border-bottom: 1px solid var(--border-color); color: var(--text-secondary); }
    .admin-btn {
      padding: 4px 12px; background: transparent; border: 1px solid var(--accent-green);
      border-radius: 40px; color: var(--accent-green); cursor: pointer; margin: 2px; font-size: 11px;
    }
    .admin-btn:hover { background: var(--accent-green); color: var(--bg-primary); }
    .admin-delete-btn { border-color: var(--accent-red); color: var(--accent-red); }
    .admin-delete-btn:hover { background: var(--accent-red); color: var(--bg-primary); }
    .admin-export-btn { border-color: var(--accent-blue); color: var(--accent-blue); margin: 10px 0; }

    .admin-messages {
      margin-top: 30px;
      padding: 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--accent-purple);
      border-radius: 24px;
    }
    .admin-messages h3 { margin-bottom: 20px; }
    .user-selector {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      background: var(--bg-primary);
      border-radius: 16px;
    }
    .user-selector input[type="text"] {
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 20px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    .user-selector .checkbox-list {
      max-height: 200px;
      overflow-y: auto;
      border-top: 1px solid var(--border-color);
      padding-top: 8px;
    }
    .user-selector label {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-secondary);
      font-size: 14px;
      padding: 4px 0;
    }
    .user-selector input[type="checkbox"] { width: auto; margin: 0; }
    .message-input {
      width: 100%;
      padding: 12px;
      border-radius: 40px;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      margin-bottom: 10px;
      resize: vertical;
    }
    .send-message-btn {
      background: var(--accent-blue);
      border: none;
      color: var(--bg-primary);
      font-weight: bold;
      padding: 12px;
      border-radius: 40px;
      cursor: pointer;
      width: 100%;
    }
    .send-message-btn:hover { background: var(--accent-green); }

    /* ===== BOT√ìN PLAN PERSONALIZADO ===== */
    .cta { margin: 30px 0; text-align: center; }
    .cta a {
      display: inline-block; padding: 16px 32px;
      background: transparent; border: 1px solid var(--accent-green);
      color: var(--accent-green); text-decoration: none; border-radius: 40px;
      font-weight: 600; letter-spacing: 2px; transition: all 0.3s ease;
      animation: glyphPulse 2s infinite;
    }
    @keyframes glyphPulse {
      0%,100% { box-shadow: 0 0 20px rgba(50, 215, 75, 0.4); }
      50% { box-shadow: 0 0 40px rgba(50, 215, 75, 0.6); }
    }
    .cta a:hover { background: var(--accent-green); color: var(--bg-primary); }

    /* ===== MODAL ===== */
    #detalleSesion {
      display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 90%; max-width: 520px; background: var(--bg-card); border: 3px solid var(--border-color);
      border-radius: 32px; padding: 0; z-index: 10000; opacity: 0; transition: all 0.3s ease;
      box-shadow: 0 20px 40px rgba(0,0,0,0.9), 0 0 30px var(--glow-color);
      pointer-events: auto;
    }
    #detalleSesion.visible { opacity: 1; transform: translateX(-50%) translateY(0); }
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); z-index: 9999;
    }
    .modal-overlay.visible { display: block; }
    .modal-content {
      padding: 40px 30px 80px;
      position: relative;
      background: var(--bg-card);
      border-radius: 29px;
      border: 2px solid var(--border-color);
      text-align: center;
    }
    .modal-content.sesion-descanso { border-color: var(--border-color); }
    .modal-content.sesion-rodaje { border-color: var(--accent-blue); }
    .modal-content.sesion-series { border-color: var(--accent-green); }
    .modal-content.sesion-tempo { border-color: var(--accent-yellow); }
    .modal-content.sesion-largo { border-color: var(--accent-red); }
    #tituloSesion {
      margin: 0 0 20px 0;
      color: var(--accent-blue);
      font-size: 22px;
      text-align: center;
    }
    #descripcionSesion {
      color: var(--text-secondary);
      line-height: 1.8;
      font-size: 14px;
      text-align: center;
      margin-bottom: 40px;
    }
    #descripcionSesion strong { color: var(--text-primary); }
    .close-btn {
      background: var(--accent-red);
      color: var(--text-primary);
      border: none;
      padding: 12px 40px;
      border-radius: 40px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }
    .close-btn:hover {
      box-shadow: 0 0 30px var(--accent-red);
      transform: translateX(-50%) scale(1.05);
    }

    /* ===== BANNER PWA ===== */
    #pwa-banner {
      position: fixed; bottom: 20px; left: 20px; right: 20px; max-width: 400px; margin: 0 auto;
      background: var(--bg-card); border: 2px solid var(--accent-blue); border-radius: 40px;
      padding: 16px 24px; display: flex; align-items: center; justify-content: space-between;
      gap: 16px; z-index: 100000; box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      animation: slideUp 0.5s ease;
    }
    @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    #pwa-banner span { color: var(--text-primary); font-size: 14px; flex: 1; }
    #pwa-banner button {
      width: auto; margin: 0; padding: 8px 16px; background: var(--accent-blue);
      border: none; color: var(--bg-primary); font-weight: bold; cursor: pointer;
    }
    #pwa-banner button:hover { background: var(--accent-green); }
    #pwa-banner .close-banner { background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); }

    /* ===== ERRORES ===== */
    .error-message {
      color: var(--accent-red); font-size: 12px; margin-top: -10px; margin-bottom: 10px;
      opacity: 0; transition: opacity 0.3s ease; text-align: center;
    }
    .error-message.visible { opacity: 1; }

    .nota-plan {
      color: var(--text-secondary); margin: 20px 0; padding: 16px;
      border: 1px dashed var(--border-color); border-radius: 16px; font-size: 12px; text-align: center;
    }
    #results { margin-top: 30px; }
    .footer {
      margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);
      text-align: center; color: var(--text-secondary); font-size: 11px; letter-spacing: 1px;
    }
    #loginPage, #mainContent, #adminPage { transition: opacity 0.3s ease; }
    .loading { position: relative; pointer-events: none; opacity: 0.7; }
    .loading::after {
      content: ""; position: absolute; top: 50%; left: 50%; width: 20px; height: 20px;
      margin: -10px 0 0 -10px; border: 2px solid var(--accent-blue); border-top-color: transparent;
      border-radius: 50%; animation: spinner 0.8s linear infinite;
    }
    @keyframes spinner { to { transform: rotate(360deg); } }
    .btn-success { background: var(--accent-green) !important; color: var(--bg-primary) !important; }
    .btn-error { background: var(--accent-red) !important; color: var(--text-primary) !important; }

    @media (max-width: 480px) {
      .card { padding: 20px; }
      .tabs-header { flex-wrap: wrap; }
      .tab-button { min-width: 60px; font-size: 11px; padding: 10px 2px; }
      .calendario-dia { font-size: 9px; padding: 2px 1px; }
      .calendario-dia div { font-size: 7px; }
      #pwa-banner { flex-direction: column; text-align: center; }
      .historial-item .fecha { padding-right: 60px; }
    }
  </style>
</head>
<body>
  <!-- BANNER PWA -->
  <div id="pwa-banner" style="display:none;">
    <span>üì≤ INSTALA RI5 EN TU M√ìVIL</span>
    <button onclick="window.instalarPWA()">INSTALAR</button>
    <button class="close-banner" onclick="window.cerrarBannerPWA()">‚úï</button>
  </div>

  <div class="modal-overlay" id="modalOverlay" onclick="window.cerrarModalSesion()"></div>

  <!-- LOGIN PAGE -->
  <div class="wrapper" id="loginPage">
    <div class="card">
      <h1>RI5</h1>
      <p style="color: var(--text-secondary); margin:20px 0; text-align:center;">> SISTEMA DE ACCESO_</p>
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="window.switchAuthTab('login')">[LOGIN]</button>
        <button class="auth-tab" onclick="window.switchAuthTab('register')">[REGISTRO]</button>
      </div>
      <div id="loginForm" class="auth-form active">
        <input type="text" id="loginUsername" placeholder="> USUARIO_">
        <input type="password" id="loginPassword" placeholder="> CONTRASE√ëA_">
        <div class="error-message" id="loginError"></div>
        <button class="button-main" onclick="window.loginUser()">[ ACCEDER ]</button>
      </div>
      <div id="registerForm" class="auth-form">
        <input type="text" id="regUsername" placeholder="> NUEVO USUARIO_">
        <input type="password" id="regPassword" placeholder="> NUEVA CONTRASE√ëA_">
        <input type="text" id="regCode" placeholder="> C√ìDIGO DE ACCESO_">
        <div class="error-message" id="registerError"></div>
        <button class="button-main" onclick="window.registerUser()">[ REGISTRARSE ]</button>
        <a class="requestCodeBtn" onclick="window.solicitarCodigo()">> SOLICITAR C√ìDIGO_</a>
      </div>
      <div class="info-card" onclick="this.classList.toggle('active')">
        <div class="title"><span>‚éî</span> QU√â PUEDES HACER <span>‚ñº</span></div>
        <div class="subtitle">// pulsa para ver todas las funciones</div>
        <div class="content">
          <div class="feature-section">
            <h4>> ENTRENO_</h4>
            <ul>
              <li><span class="feature-icon">‚ö°</span> Calcular zonas de entrenamiento</li>
              <li><span class="feature-icon">‚ù§Ô∏è</span> Obtener FC m√°xima y umbral</li>
              <li><span class="feature-icon">üìä</span> Ver predicciones para 2k, 6k, 10k, media y marat√≥n</li>
              <li><span class="feature-icon">üéØ</span> Explorar zonas Z1-Z6 con descripciones</li>
            </ul>
          </div>
          <div class="feature-section">
            <h4>> PLANES DE ENTRENAMIENTO_</h4>
            <ul>
              <li><span class="feature-icon">üìÖ</span> Generar plan personalizado</li>
              <li><span class="feature-icon">üèÉ</span> Modalidades: Runner (asfalto) y Trail (monta√±a)</li>
              <li><span class="feature-icon">üìè</span> Distancias: 2k, 5k, 10k, media marat√≥n, marat√≥n</li>
              <li><span class="feature-icon">üìà</span> Niveles: Principiante, Intermedio, Avanzado</li>
              <li><span class="feature-icon">‚è±Ô∏è</span> Duraci√≥n: 1-2 meses</li>
              <li><span class="feature-icon">üìÜ</span> Elegir d√≠a de tirada larga y fecha de inicio</li>
            </ul>
          </div>
          <div class="feature-section">
            <h4>> VISUALIZACI√ìN_</h4>
            <ul>
              <li><span class="feature-icon">üóìÔ∏è</span> Calendario interactivo semana a semana</li>
              <li><span class="feature-icon">üîç</span> Pulsar cualquier d√≠a para ver detalle de la sesi√≥n</li>
              <li><span class="feature-icon">üé®</span> Colores distintos por tipo de entrenamiento</li>
            </ul>
          </div>
          <div class="feature-section">
            <h4>> GUARDAR Y COMPARTIR_</h4>
            <ul>
              <li><span class="feature-icon">üìã</span> Copiar resultados al portapapeles</li>
              <li><span class="feature-icon">üíæ</span> Guardar c√°lculos en historial local</li>
              <li><span class="feature-icon">üìÇ</span> Cargar √∫ltimo plan guardado</li>
              <li><span class="feature-icon">üóëÔ∏è</span> Borrado individual en historial</li>
            </ul>
          </div>
          <div class="feature-section">
            <h4>> EXTRAS_</h4>
            <ul>
              <li><span class="feature-icon">üí°</span> Consejos de entrenamiento aleatorios</li>
              <li><span class="feature-icon">üì±</span> Enlace a plan personalizado</li>
              <li><span class="feature-icon">üîÑ</span> Consejos autom√°ticos cada 8 segundos</li>
              <li><span class="feature-icon">‚úâÔ∏è</span> Soporte: mensajes con el administrador</li>
            </ul>
          </div>
          <div style="text-align: center; margin-top: 20px; padding: 15px; color: var(--accent-green); border: 1px dashed var(--accent-green); border-radius: 16px;">
            > SOLICITA C√ìDIGO POR DM PARA ACCEDER <
          </div>
        </div>
      </div>
      <div id="dailyTip" class="curiosity" onclick="window.changeDailyTip()">
        <span>> CONSEJO DEL D√çA_</span><small>// pulsa para nuevo consejo</small>
      </div>
    </div>
  </div>

  <!-- ADMIN PAGE -->
  <div class="wrapper" id="adminPage" style="display:none;">
    <div class="card admin-card">
      <div class="app-header">
        <h1>RI5¬∑ADMIN</h1>
        <button class="logout-btn" onclick="window.logoutAdmin()">CERRAR SESI√ìN</button>
      </div>
      <p style="color: var(--accent-green); margin:20px 0; text-align:center;" id="adminWelcome"></p>
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="window.switchAdminTab('usuarios')">USUARIOS</button>
          <button class="tab-button" onclick="window.switchAdminTab('soporte')">SOPORTE</button>
        </div>
        <div id="admin-tab-usuarios" class="tab-content active">
          <div class="admin-stats" id="adminStats"></div>
          <div class="admin-search">
            <input type="text" id="adminSearch" placeholder="> BUSCAR USUARIO_" onkeyup="window.filtrarUsuarios()">
          </div>
          <button class="admin-btn admin-export-btn" onclick="window.exportarUsuariosCSV()">üì• EXPORTAR USUARIOS CSV</button>
          <button class="admin-btn" onclick="window.renovarExpirados()">üîÑ RENOVAR EXPIRADOS</button>
          <div class="admin-panel">
            <div class="admin-table-container">
              <table class="admin-table" id="adminTable"></table>
            </div>
          </div>
          <div class="admin-messages">
            <h3>üì® ENVIAR MENSAJE A USUARIOS</h3>
            <div class="user-selector" id="userSelector">
              <input type="text" id="userSearchInput" placeholder="üîç Buscar usuario..." onkeyup="window.filtrarCheckboxes()">
              <div class="checkbox-list" id="userCheckboxes"></div>
              <label style="margin-top:8px;"><input type="checkbox" id="selectAllUsers" onchange="window.toggleAllUsers()"> TODOS</label>
            </div>
            <textarea id="messageText" class="message-input" rows="3" placeholder="> ESCRIBE TU MENSAJE..."></textarea>
            <button class="send-message-btn" onclick="window.enviarMensaje()">üì§ ENVIAR MENSAJE</button>
            <div style="margin-top:20px;">
              <h4>üìú HISTORIAL DE MENSAJES</h4>
              <div id="mensajesEnviados"></div>
            </div>
          </div>
        </div>
        <div id="admin-tab-soporte" class="tab-content">
          <h2>SOPORTE</h2>
          <div class="soporte-section">
            <div class="soporte-tabs">
              <button class="soporte-tab active" onclick="window.cambiarAdminSoporteTab('recibidos')">üì• RECIBIDOS</button>
              <button class="soporte-tab" onclick="window.cambiarAdminSoporteTab('enviados')">üì§ ENVIADOS</button>
            </div>
            <div id="admin-soporte-recibidos" class="soporte-panel active">
              <div id="listaMensajesRecibidosAdmin"></div>
            </div>
            <div id="admin-soporte-enviados" class="soporte-panel">
              <div id="listaMensajesEnviadosAdmin"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div class="wrapper" id="mainContent" style="display:none;">
    <div class="card">
      <div class="app-header">
        <h1>RI5</h1>
        <button class="logout-btn" onclick="window.logoutUser()">CERRAR SESI√ìN</button>
      </div>
      <p style="color: var(--text-secondary); margin:20px 0; text-align:center;" id="userWelcome"></p>
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="window.switchTab('entreno')">ENTRENO</button>
          <button class="tab-button" onclick="window.switchTab('plan')">PLAN</button>
          <button class="tab-button" onclick="window.switchTab('historial')">HISTORIAL</button>
          <button class="tab-button" onclick="window.switchTab('soporte')">SOPORTE <span id="mensajesBadge" class="unread-badge" style="display:none;">0</span></button>
        </div>

        <!-- TAB ENTRENO -->
        <div id="tab-entreno" class="tab-content active">
          <h2>> ZONAS DE ENTRENO_</h2>
          <input id="name" placeholder="> NOMBRE_"><div class="error-message" id="nameError"></div>
          <input id="age" type="number" min="14" max="85" placeholder="> EDAD_"><div class="error-message" id="ageError"></div>
          <input id="time" placeholder="> TIEMPO 6km_ (MM:SS)"><div class="error-message" id="timeError"></div>
          <button class="button-main" id="calcBtn" disabled onclick="window.startCalc()">[ CALCULAR ]</button>
          <div class="curiosity" id="curiosity" onclick="window.changeConsejo()"><span>> CONSEJO_</span><small>// pulsa para nuevo consejo</small></div>
          <div id="results"></div>
        </div>

        <!-- TAB PLAN -->
        <div id="tab-plan" class="tab-content">
          <h2>> CREADOR DE PLANES_</h2>
          <button class="action-button btn-plan" onclick="window.toggleCuestionario()">+ NUEVO PLAN</button>
          <button class="action-button btn-view" onclick="window.mostrarUltimoPlanGuardado()">üìÇ CARGAR √öLTIMO PLAN</button>
          <button class="action-button btn-delete" onclick="window.borrarPlanGuardado()">üóëÔ∏è ELIMINAR PLAN</button>
          
          <div id="cuestionarioEntreno" style="display:none;">
            <h3>> CONFIGURACI√ìN_</h3>
            <select id="modalidad">
              <option value="runner">RUNNER (asfalto)</option>
              <option value="trail">TRAIL (monta√±a)</option>
            </select>

            <select id="distObjetivo">
              <option value="2k">2 km</option>
              <option value="5k">5 km</option>
              <option value="10k">10 km</option>
              <option value="medio">MEDIA MARAT√ìN</option>
              <option value="maraton" selected>MARAT√ìN</option>
            </select>

            <select id="duracionPlan" onchange="window.checkPermisosPremium()">
              <option value="1">1 MES</option>
              <option value="2">2 MESES ‚≠ê PREMIUM</option>
            </select>

            <select id="diasSemana">
              <option value="3">3 D√çAS/SEMANA</option>
              <option value="4" selected>4 D√çAS/SEMANA</option>
              <option value="5">5 D√çAS/SEMANA</option>
              <option value="6">6 D√çAS/SEMANA</option>
            </select>

            <select id="nivel">
              <option value="principiante">PRINCIPIANTE</option>
              <option value="intermedio" selected>INTERMEDIO</option>
              <option value="avanzado">AVANZADO</option>
            </select>

            <select id="experienciaDistancia">
              <option value="si">CON EXPERIENCIA</option>
              <option value="no" selected>PRIMERA VEZ</option>
            </select>

            <select id="objetivoPrincipal">
              <option value="acabar">TERMINAR</option>
              <option value="mejorar" selected>MEJORAR TIEMPO</option>
              <option value="competir">COMPETIR</option>
            </select>

            <select id="diaLargo">
              <option value="1">LUNES (tirada larga)</option>
              <option value="2">MARTES (tirada larga)</option>
              <option value="3">MI√âRCOLES (tirada larga)</option>
              <option value="4">JUEVES (tirada larga)</option>
              <option value="5">VIERNES (tirada larga)</option>
              <option value="6">S√ÅBADO (tirada larga)</option>
              <option value="7" selected>DOMINGO (tirada larga)</option>
            </select>

            <div class="fecha-inicio-container">
              <label for="fechaInicio">üìÖ FECHA DE INICIO DEL PLAN</label>
              <input type="date" id="fechaInicio" value="2025-03-01" min="2025-01-01" max="2026-12-31">
            </div>

            <button class="action-button btn-save" onclick="window.generarCalendarioEntreno()" style="margin-top:16px;">[ GENERAR PLAN ]</button>
            <button class="action-button btn-delete" onclick="window.toggleCuestionario()">[ CANCELAR ]</button>
          </div>

          <div id="calendarioEntreno" style="display:none;">
            <h3>> TU PLAN_</h3>
            <div class="nota-plan">> NOTA: Plan gen√©rico. Consulta a un profesional.</div>
            <p id="resumenObjetivo" style="color: var(--accent-blue); margin:20px 0; text-align:center;"></p>
            <div class="calendar-grid-container">
              <div class="calendar-header"><div>LUN</div><div>MAR</div><div>MI√â</div><div>JUE</div><div>VIE</div><div>S√ÅB</div><div>DOM</div></div>
              <div id="calendarioGrid"></div>
            </div>
            <button class="action-button btn-save" id="guardarPlanBtn" onclick="window.guardarPlanActual()">üíæ GUARDAR PLAN</button>
            <button class="action-button btn-delete" onclick="window.cerrarPlan()">[ CERRAR ]</button>
          </div>
        </div>

        <!-- TAB HISTORIAL -->
        <div id="tab-historial" class="tab-content">
          <h2>> HISTORIAL_</h2>
          <div id="historialContainer"></div>
          <button class="action-button btn-delete" onclick="window.borrarHistorial()" style="margin-top:16px;">üóëÔ∏è LIMPIAR TODO EL HISTORIAL</button>
        </div>

        <!-- TAB SOPORTE -->
        <div id="tab-soporte" class="tab-content">
          <h2>> SOPORTE_</h2>
          <div class="soporte-section">
            <div class="soporte-tabs">
              <button class="soporte-tab active" onclick="window.cambiarSoporteTab('recibidos')">üì• RECIBIDOS</button>
              <button class="soporte-tab" onclick="window.cambiarSoporteTab('enviados')">üì§ ENVIADOS</button>
            </div>
            <div id="soporte-recibidos" class="soporte-panel active">
              <h3>Mensajes del administrador</h3>
              <div id="listaMensajesRecibidos"></div>
            </div>
            <div id="soporte-enviados" class="soporte-panel">
              <h3>Tus mensajes al admin</h3>
              <div class="nuevo-mensaje">
                <textarea id="mensajeUsuario" class="message-input" rows="3" placeholder="> ESCRIBE TU CONSULTA..."></textarea>
                <button class="send-message-btn" onclick="window.enviarMensajeUsuario()">üì§ ENVIAR MENSAJE</button>
              </div>
              <div id="listaMensajesEnviados" style="margin-top:20px;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL DETALLE -->
      <div id="detalleSesion">
        <div class="modal-content" id="modalColorWrapper">
          <h3 id="tituloSesion"></h3>
          <div id="descripcionSesion"></div>
          <button class="close-btn" onclick="window.cerrarModalSesion()">[ CERRAR ]</button>
        </div>
      </div>

      <div class="cta"><a href="https://www.instagram.com/navegacionpro" target="_blank">[ PLAN PERSONALIZADO ‚Üí ]</a></div>
      <div class="footer" id="footer"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    (function() {
      // ==================== CONFIGURACI√ìN DE FIREBASE ====================
      const firebaseConfig = {
        apiKey: "AIzaSyBw4VYLEeFeG4Z2qJC56iPzzuAzlIkmErc",
        authDomain: "ri5-5b642.firebaseapp.com",
        databaseURL: "https://ri5-5b642-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "ri5-5b642",
        storageBucket: "ri5-5b642.firebasestorage.app",
        messagingSenderId: "889154598385",
        appId: "1:889154598385:web:1d4e7dad605a42c1c60050",
        measurementId: "G-NGY11DD78C"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // ==================== M√ìDULO UTILS ====================
      const Utils = {
        parseTime(t) {
          t = t.trim(); if (!t) return NaN;
          const match = t.match(/^(\d{1,3}):?(\d{0,2})$/);
          if (!match) return NaN;
          const m = parseInt(match[1]), s = match[2] ? parseInt(match[2]) : 0;
          return (s > 59 || m > 120 || m < 10) ? NaN : m + s/60;
        },
        formatR(r) {
          if (!isFinite(r) || r <= 0) return "--:--";
          let m = Math.floor(r), s = Math.round((r - m) * 60);
          if (s === 60) { m++; s = 0; }
          return m + ":" + (s < 10 ? '0' : '') + s;
        },
        showLoading(btn) { btn.classList.add('loading'); btn.disabled = true; },
        hideLoading(btn) { btn.classList.remove('loading'); btn.disabled = false; },
        showTemporaryMessage(btn, msg, ok = true) {
          const orig = btn.innerText;
          btn.innerText = msg;
          btn.classList.add(ok ? 'btn-success' : 'btn-error');
          setTimeout(() => { btn.innerText = orig; btn.classList.remove('btn-success', 'btn-error'); }, 2000);
        },
        hashPassword(str) { return btoa(str + "_RI5_SALT"); }
      };

      // ==================== M√ìDULO STORAGE (FIREBASE) ====================
      const Storage = {
        // ========== USUARIOS (global) ==========
        getUsers() {
          return db.ref('users').once('value').then(snapshot => snapshot.val() || {});
        },
        saveUsers(u) {
          return db.ref('users').set(u);
        },

        // ========== HISTORIAL (por usuario) ==========
        getHistorial(username) {
          if (!username) return Promise.resolve([]);
          return db.ref('users/' + username + '/historial').once('value').then(snapshot => snapshot.val() || []);
        },
        saveHistorial(username, h) {
          if (!username) return Promise.reject('No user');
          return db.ref('users/' + username + '/historial').set(h);
        },

        // ========== √öLTIMO PLAN (por usuario) ==========
        getUltimoPlan(username) {
          if (!username) return Promise.resolve(null);
          return db.ref('users/' + username + '/ultimoPlan').once('value').then(snapshot => snapshot.val() || null);
        },
        setUltimoPlan(username, p) {
          if (!username) return Promise.reject('No user');
          return db.ref('users/' + username + '/ultimoPlan').set(p);
        },
        removeUltimoPlan(username) {
          if (!username) return Promise.reject('No user');
          return db.ref('users/' + username + '/ultimoPlan').remove();
        },

        // ========== MENSAJES (global, para comunicaci√≥n) ==========
        getMensajes() {
          return db.ref('mensajes').once('value').then(snapshot => snapshot.val() || {});
        },
        saveMensajes(m) {
          return db.ref('mensajes').set(m);
        },
        getMensajesUsuario(u) {
          return this.getMensajes().then(todos => {
            const ahora = Date.now();
            const lista = todos[u] || [];
            const validos = lista.filter(m => {
              if (!m.leido) return true;
              if (!m.fechaLectura) return true;
              const diffHoras = (ahora - new Date(m.fechaLectura).getTime()) / (1000 * 60 * 60);
              return diffHoras < 24;
            });
            if (validos.length !== lista.length) {
              todos[u] = validos;
              return this.saveMensajes(todos).then(() => validos);
            }
            return validos;
          });
        },
        marcarLeido(u, index) {
          return this.getMensajes().then(todos => {
            if (todos[u] && todos[u][index]) {
              todos[u][index].leido = true;
              todos[u][index].fechaLectura = new Date().toISOString();
              return this.saveMensajes(todos);
            }
          });
        },
        enviarMensajeUsuario(usuario, texto) {
          return this.getMensajes().then(todos => {
            const adminKey = "admin_" + usuario;
            if (!todos[adminKey]) todos[adminKey] = [];
            todos[adminKey].push({
              fecha: new Date().toLocaleString(),
              texto: texto,
              leido: false,
              esUsuario: true
            });
            return this.saveMensajes(todos);
          });
        },
        getMensajesEnviadosUsuario(u) {
          return this.getMensajes().then(todos => {
            const adminKey = "admin_" + u;
            return todos[adminKey] || [];
          });
        },
        getMensajesRecibidosAdmin() {
          return this.getMensajes().then(todos => {
            const recibidos = [];
            Object.keys(todos).forEach(key => {
              if (key.startsWith('admin_')) {
                const usuario = key.replace('admin_', '');
                todos[key].forEach((msg, idx) => {
                  recibidos.push({ usuario, mensaje: msg, idx, key });
                });
              }
            });
            return recibidos;
          });
        },
        getMensajesEnviadosAdmin() {
          return this.getMensajes().then(todos => {
            const enviados = [];
            Object.keys(todos).forEach(key => {
              if (!key.startsWith('admin_')) {
                todos[key].forEach((msg, idx) => {
                  if (msg.esAdmin) {
                    enviados.push({ usuario: key, mensaje: msg, idx, key });
                  }
                });
              }
            });
            return enviados;
          });
        },
        borrarMensaje(key, idx) {
          return this.getMensajes().then(todos => {
            if (todos[key] && todos[key][idx]) {
              todos[key].splice(idx, 1);
              if (todos[key].length === 0) delete todos[key];
              return this.saveMensajes(todos);
            }
          });
        }
      };

      // ==================== ESTADO GLOBAL ====================
      const AppState = {
        zonasCalculadas: false, lastName: "", lastAge: 0, lastFC: 0, lastUL: 0,
        lastZones: [], lastPred: [], lastRitmoBase: 0,
        ultimoPlanParams: null, planGeneradoActual: null,
        camposTocados: { name: false, age: false, time: false },
        currentUser: null, currentSesionDetalle: null, deferredPrompt: null,
        mensajesNoLeidos: 0,
        setLastCalc(d) {
          this.lastName = d.name; this.lastAge = d.age; this.lastFC = d.fcMax;
          this.lastUL = d.ul; this.lastZones = d.zones; this.lastPred = d.pred;
          this.lastRitmoBase = d.ritmoBase; this.zonasCalculadas = true;
        },
        clearLastCalc() {
          this.zonasCalculadas = false; this.lastName = ""; this.lastAge = 0;
          this.lastFC = 0; this.lastUL = 0; this.lastZones = []; this.lastPred = [];
          this.lastRitmoBase = 0;
        },
        setCurrentUser(u) {
          this.currentUser = u;
          u ? localStorage.setItem('ri5_current_user', u) : localStorage.removeItem('ri5_current_user');
        }
      };

      // ==================== M√ìDULO AUTENTICACI√ìN ====================
      const Auth = {
        switchAuthTab(tab) {
          document.querySelectorAll('.auth-tab').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
          if (tab === 'login') {
            document.querySelector('.auth-tab').classList.add('active');
            document.getElementById('loginForm').classList.add('active');
          } else {
            document.querySelectorAll('.auth-tab')[1].classList.add('active');
            document.getElementById('registerForm').classList.add('active');
          }
        },
        solicitarCodigo() { alert('üì± Solicita c√≥digo por DM a @navegacionpro en Instagram'); },
        async registerUser() {
          const username = document.getElementById('regUsername').value.trim();
          const password = document.getElementById('regPassword').value.trim();
          const code = document.getElementById('regCode').value.trim().toUpperCase();
          const err = document.getElementById('registerError');
          if (!username || !password || !code) { err.innerText = "> COMPLETA TODOS LOS CAMPOS_"; err.classList.add('visible'); return; }
          if (username.length < 3) { err.innerText = "> USUARIO M√çNIMO 3 CARACTERES_"; err.classList.add('visible'); return; }
          if (password.length < 4) { err.innerText = "> CONTRASE√ëA M√çNIMO 4 CARACTERES_"; err.classList.add('visible'); return; }
          const d = new Date(), codigoEsperado = "RI5" + String(d.getDate()).padStart(2,'0') + String(d.getMonth()+1).padStart(2,'0');
          if (!["RI5ADMIN","TEST1234",codigoEsperado].includes(code)) { err.innerText = "> C√ìDIGO INV√ÅLIDO_"; err.classList.add('visible'); return; }
          const users = await Storage.getUsers();
          if (users[username]) { err.innerText = "> EL USUARIO YA EXISTE_"; err.classList.add('visible'); return; }
          const expiry = new Date(); expiry.setMonth(expiry.getMonth()+1);
          users[username] = { password: Utils.hashPassword(password), created: new Date().toISOString(), expires: expiry.toISOString() };
          await Storage.saveUsers(users);
          AppState.setCurrentUser(username);
          document.getElementById("loginPage").style.opacity = "0";
          setTimeout(() => {
            document.getElementById("loginPage").style.display = "none";
            document.getElementById("mainContent").style.display = "flex";
            document.getElementById("userWelcome").innerText = `> BIENVENIDO, ${username.toUpperCase()}_ ¬∑ ACCESO HASTA ${expiry.toLocaleDateString()}`;
            document.getElementById("mainContent").style.opacity = "1";
            UI.changeDailyTip(); UI.startConsejoAutoChange();
          }, 300);
        },
        async loginUser() {
          const username = document.getElementById('loginUsername').value.trim();
          const password = document.getElementById('loginPassword').value.trim();
          const err = document.getElementById('loginError');
          if (!username || !password) { err.innerText = "> INTRODUCE USUARIO Y CONTRASE√ëA_"; err.classList.add('visible'); return; }
          if (username === 'admin' && password === '091118110485120385') { Auth.mostrarAdminPanel(); return; }
          const users = await Storage.getUsers();
          const user = users[username];
          if (!user || user.password !== Utils.hashPassword(password)) { err.innerText = "> USUARIO O CONTRASE√ëA INCORRECTOS_"; err.classList.add('visible'); return; }
          const now = new Date(), expiry = new Date(user.expires);
          if (now > expiry) { err.innerText = "> TU ACCESO HA EXPIRADO. SOLICITA UN NUEVO C√ìDIGO._"; err.classList.add('visible'); return; }
          AppState.setCurrentUser(username);
          const mensajes = await Storage.getMensajesUsuario(username);
          AppState.mensajesNoLeidos = mensajes.filter(m => !m.leido).length;
          UI.actualizarBadgeMensajes();
          document.getElementById("loginPage").style.opacity = "0";
          setTimeout(() => {
            document.getElementById("loginPage").style.display = "none";
            document.getElementById("mainContent").style.display = "flex";
            document.getElementById("userWelcome").innerText = `> BIENVENIDO, ${username.toUpperCase()}_ ¬∑ ACCESO HASTA ${expiry.toLocaleDateString()}`;
            document.getElementById("mainContent").style.opacity = "1";
            UI.changeDailyTip(); UI.startConsejoAutoChange();
            UI.cargarMensajesRecibidos();
            UI.cargarMensajesEnviados();
          }, 300);
        },
        mostrarAdminPanel() {
          document.getElementById("loginPage").style.display = "none";
          document.getElementById("mainContent").style.display = "none";
          document.getElementById("adminPage").style.display = "flex";
          Admin.actualizarAdminPanel();
        },
        logoutUser() {
          if (!confirm("> ¬øCERRAR SESI√ìN?_")) return;
          AppState.setCurrentUser(null);
          document.getElementById("mainContent").style.display = "none";
          document.getElementById("loginPage").style.display = "flex";
          document.getElementById("loginUsername").value = ''; document.getElementById("loginPassword").value = '';
          document.getElementById("results").innerHTML = ''; document.getElementById("calendarioEntreno").style.display = "none";
          AppState.clearLastCalc();
        },
        logoutAdmin() {
          document.getElementById("adminPage").style.display = "none";
          document.getElementById("loginPage").style.display = "flex";
        },
        async checkSavedSession() {
          const saved = localStorage.getItem('ri5_current_user');
          if (!saved) return false;
          const users = await Storage.getUsers();
          const user = users[saved];
          if (!user) { localStorage.removeItem('ri5_current_user'); return false; }
          if (new Date() > new Date(user.expires)) { localStorage.removeItem('ri5_current_user'); return false; }
          AppState.currentUser = saved;
          document.getElementById("loginPage").style.display = "none";
          document.getElementById("mainContent").style.display = "flex";
          document.getElementById("userWelcome").innerText = `> BIENVENIDO, ${saved.toUpperCase()}_ ¬∑ ACCESO HASTA ${new Date(user.expires).toLocaleDateString()}`;
          UI.changeDailyTip(); UI.startConsejoAutoChange();
          return true;
        },
        isUserPremium() {
          return true; // Simplificado
        },
        checkPermisosPremium() {
          const sel = document.getElementById('duracionPlan');
          if (sel.value === '2' && !Auth.isUserPremium()) {
            alert("‚≠ê PLAN PREMIUM\n\nLos planes de 2 meses son exclusivos para usuarios con suscripci√≥n activa.\n\nContacta a @navegacionpro en Instagram.");
            sel.value = '1';
          }
        }
      };

      // ==================== M√ìDULO ADMIN ====================
      const Admin = {
        async actualizarAdminPanel() {
          const users = await Storage.getUsers();
          const total = Object.keys(users).length;
          const ahora = new Date();
          const activos = Object.values(users).filter(u => new Date(u.expires) > ahora).length;
          const expirados = total - activos;
          document.getElementById("adminStats").innerHTML = `
            <div class="stat-card"><span class="number">${total}</span><span class="label">TOTAL</span></div>
            <div class="stat-card"><span class="number">${activos}</span><span class="label">ACTIVOS</span></div>
            <div class="stat-card"><span class="number">${expirados}</span><span class="label">EXPIRADOS</span></div>
          `;
          let html = '<table class="admin-table"><tr><th>USUARIO</th><th>CREADO</th><th>EXPIRA</th><th>ESTADO</th><th>ACCIONES</th></tr>';
          Object.entries(users).forEach(([u,d]) => {
            const creado = new Date(d.created).toLocaleDateString();
            const expiry = new Date(d.expires).toLocaleDateString();
            const premium = new Date() <= new Date(d.expires);
            html += `<tr><td>${u}</td><td>${creado}</td><td>${expiry}</td>
              <td style="color:${premium?'var(--accent-green)':'var(--accent-red)'};">${premium?'PREMIUM':'EXPIRADO'}</td>
              <td>
                <button class="admin-btn" onclick="window.extenderUsuario('${u}',1)">+1 MES</button>
                <button class="admin-btn" onclick="window.extenderUsuario('${u}',2)">+2 MESES</button>
                <button class="admin-delete-btn" onclick="window.eliminarUsuario('${u}')">ELIMINAR</button>
              </td></tr>`;
          });
          html += '</table>';
          document.getElementById("adminTable").innerHTML = html;
          document.getElementById("adminWelcome").innerText = `> BIENVENIDO, ADMIN_ ¬∑ ${new Date().toLocaleString()}`;
          this.actualizarSelectorUsuarios();
          this.mostrarHistorialMensajes();
        },
        async filtrarUsuarios() {
          const search = document.getElementById("adminSearch").value.toLowerCase();
          const users = await Storage.getUsers();
          let html = '<table class="admin-table"><tr><th>USUARIO</th><th>CREADO</th><th>EXPIRA</th><th>ESTADO</th><th>ACCIONES</th></tr>';
          Object.entries(users).forEach(([u,d]) => {
            if (!u.toLowerCase().includes(search)) return;
            const creado = new Date(d.created).toLocaleDateString();
            const expiry = new Date(d.expires).toLocaleDateString();
            const premium = new Date() <= new Date(d.expires);
            html += `<tr><td>${u}</td><td>${creado}</td><td>${expiry}</td>
              <td style="color:${premium?'var(--accent-green)':'var(--accent-red)'};">${premium?'PREMIUM':'EXPIRADO'}</td>
              <td>
                <button class="admin-btn" onclick="window.extenderUsuario('${u}',1)">+1 MES</button>
                <button class="admin-btn" onclick="window.extenderUsuario('${u}',2)">+2 MESES</button>
                <button class="admin-delete-btn" onclick="window.eliminarUsuario('${u}')">ELIMINAR</button>
              </td></tr>`;
          });
          document.getElementById("adminTable").innerHTML = html + '</table>';
        },
        async extenderUsuario(u, m) {
          const users = await Storage.getUsers();
          if (users[u]) {
            const expiry = new Date(users[u].expires);
            expiry.setMonth(expiry.getMonth() + m);
            users[u].expires = expiry.toISOString();
            await Storage.saveUsers(users);
            this.actualizarAdminPanel();
            alert(`‚úÖ Usuario ${u} extendido ${m} mes(es)`);
          }
        },
        async eliminarUsuario(u) {
          if (!confirm(`> ¬øELIMINAR USUARIO "${u}"?`)) return;
          const users = await Storage.getUsers();
          delete users[u];
          await Storage.saveUsers(users);
          if (AppState.currentUser === u) AppState.setCurrentUser(null);
          this.actualizarAdminPanel();
          alert(`‚úÖ Usuario ${u} eliminado`);
        },
        exportarUsuariosCSV() {
          Storage.getUsers().then(users => {
            let csv = "Usuario,Creado,Expira,Estado\n";
            Object.entries(users).forEach(([u,d]) => {
              const creado = new Date(d.created).toLocaleDateString();
              const expiry = new Date(d.expires).toLocaleDateString();
              const estado = new Date() <= new Date(d.expires) ? "PREMIUM" : "EXPIRADO";
              csv += `${u},${creado},${expiry},${estado}\n`;
            });
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `usuarios_${new Date().toISOString().split('T')[0]}.csv`;
            a.click(); URL.revokeObjectURL(a.href);
          });
        },
        async renovarExpirados() {
          if (!confirm("> ¬øRENOVAR TODOS LOS USUARIOS EXPIRADOS POR 1 MES?")) return;
          const users = await Storage.getUsers();
          const ahora = new Date();
          Object.entries(users).forEach(([u,d]) => {
            if (new Date(d.expires) <= ahora) {
              const expiry = new Date(d.expires);
              expiry.setMonth(expiry.getMonth() + 1);
              users[u].expires = expiry.toISOString();
            }
          });
          await Storage.saveUsers(users);
          this.actualizarAdminPanel();
          alert("‚úÖ USUARIOS EXPIRADOS RENOVADOS");
        },
        actualizarSelectorUsuarios() {
          Storage.getUsers().then(users => {
            let html = '';
            Object.keys(users).forEach(u => html += `<label><input type="checkbox" class="user-checkbox" value="${u}"> ${u}</label>`);
            document.getElementById('userCheckboxes').innerHTML = html;
            window.filtrarCheckboxes();
          });
        },
        toggleAllUsers() {
          const sel = document.getElementById('selectAllUsers').checked;
          document.querySelectorAll('.user-checkbox').forEach(cb => cb.checked = sel);
        },
        filtrarCheckboxes() {
          const filtro = document.getElementById('userSearchInput').value.toLowerCase();
          const labels = document.querySelectorAll('#userCheckboxes label');
          labels.forEach(label => {
            const texto = label.textContent.toLowerCase();
            if (texto.includes(filtro)) {
              label.style.display = 'flex';
            } else {
              label.style.display = 'none';
            }
          });
        },
        async enviarMensaje() {
          const selectAll = document.getElementById('selectAllUsers').checked;
          let usuarios = [];
          if (selectAll) {
            const users = await Storage.getUsers();
            usuarios = Object.keys(users);
          } else {
            document.querySelectorAll('.user-checkbox:checked').forEach(cb => usuarios.push(cb.value));
          }
          const texto = document.getElementById('messageText').value.trim();
          if (!texto) return alert('> ESCRIBE UN MENSAJE_');
          if (usuarios.length === 0) return alert('> SELECCIONA AL MENOS UN USUARIO_');
          const mensajes = await Storage.getMensajes();
          const fecha = new Date().toLocaleString();
          usuarios.forEach(u => {
            if (!mensajes[u]) mensajes[u] = [];
            mensajes[u].push({ fecha, texto, leido: false, esAdmin: true });
          });
          await Storage.saveMensajes(mensajes);
          document.getElementById('messageText').value = '';
          alert(`‚úÖ MENSAJE ENVIADO A ${usuarios.length} USUARIO(S)`);
          this.mostrarHistorialMensajes();
          Admin.cargarMensajesAdmin();
        },
        async mostrarHistorialMensajes() {
          const mensajes = await Storage.getMensajes();
          let html = '<ul style="list-style:none; padding:0;">';
          Object.entries(mensajes).forEach(([u, lista]) => {
            lista.forEach((msg, i) => {
              if (msg.esAdmin) return;
              html += `<li style="margin-bottom:10px; padding:10px; background:var(--bg-primary); border-radius:16px;">
                <strong>${u}</strong> - ${msg.fecha} ${msg.leido ? '‚úÖ' : 'üìå'}<br>${msg.texto}
              </li>`;
            });
          });
          html += '</ul>';
          document.getElementById('mensajesEnviados').innerHTML = html || '<p>üì≠ NO HAY MENSAJES</p>';
        },
        async cargarMensajesAdmin() {
          const recibidos = await Storage.getMensajesRecibidosAdmin();
          let htmlRec = '';
          recibidos.forEach(item => {
            htmlRec += `
              <div class="mensaje-item">
                <div class="mensaje-header">
                  <span>üì® ${item.mensaje.fecha} ¬∑ ${item.usuario}</span>
                  <span class="flecha">‚ñº</span>
                  <button class="delete-mensaje" onclick="window.borrarMensajeAdmin('${item.key}', ${item.idx})">üóëÔ∏è</button>
                </div>
                <div class="mensaje-contenido">${item.mensaje.texto}</div>
              </div>
            `;
          });
          document.getElementById('listaMensajesRecibidosAdmin').innerHTML = htmlRec || '<p>üì≠ NO HAY MENSAJES</p>';
          
          const enviados = await Storage.getMensajesEnviadosAdmin();
          let htmlEnv = '';
          enviados.forEach(item => {
            htmlEnv += `
              <div class="mensaje-item">
                <div class="mensaje-header">
                  <span>üì§ ${item.mensaje.fecha} ¬∑ Para ${item.usuario}</span>
                  <span class="flecha">‚ñº</span>
                  <button class="delete-mensaje" onclick="window.borrarMensajeAdmin('${item.key}', ${item.idx})">üóëÔ∏è</button>
                </div>
                <div class="mensaje-contenido">${item.mensaje.texto}</div>
              </div>
            `;
          });
          document.getElementById('listaMensajesEnviadosAdmin').innerHTML = htmlEnv || '<p>üì≠ NO HAS ENVIADO MENSAJES</p>';
        },
        cambiarSoporteTab(tab) {
          document.querySelectorAll('#admin-tab-soporte .soporte-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('#admin-tab-soporte .soporte-panel').forEach(p => p.classList.remove('active'));
          if (tab === 'recibidos') {
            document.querySelectorAll('#admin-tab-soporte .soporte-tab')[0].classList.add('active');
            document.getElementById('admin-soporte-recibidos').classList.add('active');
          } else {
            document.querySelectorAll('#admin-tab-soporte .soporte-tab')[1].classList.add('active');
            document.getElementById('admin-soporte-enviados').classList.add('active');
          }
        }
      };

      window.filtrarCheckboxes = Admin.filtrarCheckboxes.bind(Admin);
      window.borrarMensajeAdmin = function(key, idx) {
        Storage.borrarMensaje(key, idx).then(() => Admin.cargarMensajesAdmin());
      };

      window.switchAdminTab = function(tab) {
        document.querySelectorAll('#adminPage .tab-button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('#adminPage .tab-content').forEach(c => c.classList.remove('active'));
        if (tab === 'usuarios') {
          document.querySelectorAll('#adminPage .tab-button')[0].classList.add('active');
          document.getElementById('admin-tab-usuarios').classList.add('active');
        } else {
          document.querySelectorAll('#adminPage .tab-button')[1].classList.add('active');
          document.getElementById('admin-tab-soporte').classList.add('active');
          Admin.cargarMensajesAdmin();
        }
      };

      window.cambiarAdminSoporteTab = function(tab) {
        Admin.cambiarSoporteTab(tab);
      };

      // ==================== M√ìDULO ENTRENAMIENTO ====================
      const Training = {
        startCalc() {
          UI.validarTodo();
          if (document.getElementById("calcBtn").disabled) return;
          const btn = document.getElementById("calcBtn");
          Utils.showLoading(btn);
          setTimeout(() => {
            this.calculate();
            Utils.hideLoading(btn);
            Utils.showTemporaryMessage(btn, "‚úì CALCULADO", true);
            document.getElementById('results').scrollIntoView({behavior:'smooth'});
          }, 300);
        },
        calculate() {
          const name = document.getElementById("name").value.trim();
          const age = parseInt(document.getElementById("age").value);
          const t = Utils.parseTime(document.getElementById("time").value);
          if (!name || !age || isNaN(t)) return alert("> COMPLETA TODOS LOS CAMPOS CORRECTAMENTE_");
          const ritmoBase = t / 6;
          const fcMax = 220 - age;
          const UL = Math.round(fcMax * 0.92 * 1.03);
          const pred = [
            {dist:2, color:"var(--accent-blue)", ritmo:ritmoBase*0.98},
            {dist:6, color:"var(--accent-green)", ritmo:ritmoBase},
            {dist:10,color:"var(--accent-yellow)", ritmo:ritmoBase*1.05},
            {dist:21,color:"var(--accent-red)", ritmo:ritmoBase*1.12},
            {dist:42,color:"var(--accent-purple)", ritmo:ritmoBase*1.20}
          ];
          const zones = [
            ["Z1","RECUPERACI√ìN",0.75,0.80,1.35,"z1","RITMO: "+Utils.formatR(ritmoBase*1.35)+"<br><br>üîπ Promueve recuperaci√≥n activa, regeneraci√≥n muscular. Ideal despu√©s de sesiones duras."],
            ["Z2","BASE",0.80,0.90,1.25,"z2","RITMO: "+Utils.formatR(ritmoBase*1.25)+"<br><br>üîπ Mejora eficiencia metab√≥lica, capilarizaci√≥n. Base de todo entrenamiento."],
            ["Z3","TEMPO",0.90,0.95,1.15,"z3","RITMO: "+Utils.formatR(ritmoBase*1.15)+"<br><br>üîπ Aumenta tolerancia al lactato. Puente entre aer√≥bico y umbral."],
            ["Z4","UMBRAL",0.95,1.02,1.05,"z4","RITMO: "+Utils.formatR(ritmoBase*1.05)+"<br><br>üîπ Entrena sistema de limpieza de lactato. Ritmo 'c√≥modamente duro'."],
            ["Z5","VO‚ÇÇM√ÅX",1.02,1.06,0.95,"z5","RITMO: "+Utils.formatR(ritmoBase*0.95)+"<br><br>üîπ Mejora potencia aer√≥bica m√°xima. Esfuerzos intensos de 3-8 minutos."],
            ["Z6","VELOCIDAD",1.06,1.12,0.85,"z6","RITMO: "+Utils.formatR(ritmoBase*0.85)+"<br><br>üîπ Desarrolla potencia neuromuscular. Reclutamiento de fibras r√°pidas."]
          ];
          AppState.setLastCalc({name, age, fcMax, ul:UL, zones, pred, ritmoBase});
          let html = `<h2>> M√âTRICAS_</h2><div style="text-align:center; margin:20px 0;">
            ${name} ¬∑ ${age} a√±os<br>
            FC M√ÅX: ${fcMax} lpm ¬∑ UMBRAL: ${UL} lpm<br>
            RITMO 6km: ${Utils.formatR(ritmoBase)} min/km
          </div>`;
          html += `<h2>> PREDICCIONES_</h2>`;
          pred.forEach(p => html += `<div class="pred-bar" style="border-color:${p.color}; color:${p.color};">${p.dist} km ‚Üí ${Utils.formatR(p.ritmo)} min/km</div>`);
          html += `<h2>> ZONAS_</h2>`;
          zones.forEach(z => {
            const min = Math.round(UL * z[2]), max = Math.round(UL * z[3]);
            html += `<div class="zone-card ${z[5]}" onclick="this.classList.toggle('active')"><strong>${z[0]} ‚Äì ${z[1]}</strong><br>FC: ${min}-${max} lpm<div class="long">${z[6]}</div></div>`;
          });
          html += `<button class="action-button btn-copy" onclick="window.copyResults()">üìã COPIAR RESULTADOS</button>
                   <button class="action-button btn-save" onclick="window.guardarCalculo()">üíæ GUARDAR HISTORIAL</button>`;
          document.getElementById("results").innerHTML = html;
          document.getElementById("footer").innerText = `${name} ¬∑ ${new Date().toLocaleDateString('es-ES')} ¬∑ RI5`;
        },
        copyResults() {
          if (!AppState.lastName) return alert("> CALCULA ZONAS PRIMERO_");
          let text = "üîπ RI5 - ZONAS DE ENTRENO üîπ\n\n";
          text += `üë§ ${AppState.lastName} ¬∑ ${AppState.lastAge} a√±os\n`;
          text += `‚ù§Ô∏è FC M√ÅX: ${AppState.lastFC} lpm ¬∑ UMBRAL: ${AppState.lastUL} lpm\n`;
          text += `‚è±Ô∏è RITMO 6km: ${Utils.formatR(AppState.lastRitmoBase)} min/km\n\nüìä PREDICCIONES:\n`;
          AppState.lastPred.forEach(p => text += `   ${p.dist} km ‚Üí ${Utils.formatR(p.ritmo)} min/km\n`);
          text += `\nüéØ ZONAS:\n`;
          AppState.lastZones.forEach(z => {
            const min = Math.round(AppState.lastUL * z[2]), max = Math.round(AppState.lastUL * z[3]);
            text += `   ${z[0]} ${z[1]}: ${min}-${max} lpm ¬∑ ${z[6].replace(/<br>/g,' ').replace(/üîπ/g,'‚Ä¢')}\n`;
          });
          text += `\nüìÖ ${new Date().toLocaleDateString('es-ES')} ¬∑ RI5`;
          navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector('.btn-copy');
            if (btn) Utils.showTemporaryMessage(btn, "‚úÖ COPIADO", true);
          }).catch(() => alert("> NO SE PUDO COPIAR. SELECCIONA MANUALMENTE_"));
        },
        async guardarCalculo() {
          if (!AppState.lastName) return alert("> CALCULA ZONAS PRIMERO_");
          if (!AppState.currentUser) return alert("> NO HAY USUARIO_");
          const ahora = new Date();
          // Crear resumen de zonas
          let zonasResumen = '';
          if (AppState.lastZones && AppState.lastZones.length) {
            zonasResumen = AppState.lastZones.map(z => {
              const min = Math.round(AppState.lastUL * z[2]);
              const max = Math.round(AppState.lastUL * z[3]);
              return `${z[0]}: ${min}-${max}`;
            }).join(' ¬∑ ');
          }
          const data = {
            date: ahora.toLocaleDateString('es-ES'), hora: ahora.toLocaleTimeString('es-ES'),
            fechaCompleta: ahora.toLocaleDateString('es-ES') + ' ' + ahora.toLocaleTimeString('es-ES'),
            nombre: AppState.lastName, edad: AppState.lastAge, fcMax: AppState.lastFC,
            umbral: AppState.lastUL, ritmo6k: Utils.formatR(AppState.lastRitmoBase),
            predicciones: AppState.lastPred.map(p => `${p.dist}km:${Utils.formatR(p.ritmo)}`).join(' '),
            resumen: `${AppState.lastName} ¬∑ ${AppState.lastAge} a√±os ¬∑ 6km: ${Utils.formatR(AppState.lastRitmoBase)}`,
            zonasResumen: zonasResumen
          };
          let hist = await Storage.getHistorial(AppState.currentUser);
          hist.unshift(data); if (hist.length > 20) hist.pop();
          await Storage.saveHistorial(AppState.currentUser, hist);
          if (document.getElementById('tab-historial').classList.contains('active')) UI.cargarHistorial();
          const btn = document.querySelector('.btn-save');
          if (btn) Utils.showTemporaryMessage(btn, "‚úÖ GUARDADO", true);
        }
      };

      // ==================== M√ìDULO UI ====================
      const UI = {
        consejos: ["La constancia supera al talento cuando el talento no entrena.", "El descanso es tan importante como el entrenamiento.", "La Z2 es la base; nunca la abandones.", "La hidrataci√≥n empieza 24h antes del entrenamiento.", "Duerme 7-9h; el sue√±o construye resistencia.", "El volumen semanal no debe aumentar m√°s del 10%.", "Los intervalos cortos mejoran la velocidad m√°xima.", "Las cuestas desarrollan potencia sin impacto.", "La visualizaci√≥n mental tambi√©n entrena el cerebro.", "El umbral l√°ctico es el mejor predictor de rendimiento.", "Incluye fuerza 2 veces por semana.", "Una zancada eficiente ahorra energ√≠a en larga distancia.", "La progresi√≥n antes de la competici√≥n es clave.", "La periodizaci√≥n previene estancamiento y lesiones.", "La recuperaci√≥n activa acelera la eliminaci√≥n de lactato.", "Monitorea tu FC en reposo; m√°s baja = mejor forma.", "Los rodajes largos construyen confianza mental."],
        consejoIndex: 0,
        changeDailyTip() {
          const el = document.getElementById("dailyTip");
          setTimeout(() => {
            el.innerHTML = '<span>> ' + this.consejos[this.consejoIndex] + '</span><small>// pulsa para nuevo consejo</small>';
            this.consejoIndex = (this.consejoIndex + 1) % this.consejos.length;
          }, 100);
        },
        changeConsejo() {
          const el = document.getElementById("curiosity");
          setTimeout(() => {
            el.innerHTML = '<span>' + this.consejos[this.consejoIndex] + '</span><small>// pulsa para nuevo consejo</small>';
            this.consejoIndex = (this.consejoIndex + 1) % this.consejos.length;
          }, 100);
        },
        startConsejoAutoChange() {
          setInterval(() => {
            if (document.getElementById("loginPage").style.display !== "none") this.changeDailyTip();
            if (document.getElementById("mainContent").style.display !== "none") this.changeConsejo();
          }, 8000);
        },
        marcarCampoTocado(c) { AppState.camposTocados[c] = true; this.validarCampo(c); this.validarTodo(); },
        validarCampo(c) {
          const el = document.getElementById(c), err = document.getElementById(c+'Error');
          if (!AppState.camposTocados[c]) { err.classList.remove('visible'); el.classList.remove('error'); return true; }
          let ok = true, msg = '';
          if (c === 'name') ok = el.value.trim().length >= 2; else if (c === 'age') { const a = parseInt(el.value); ok = !isNaN(a) && a>=14 && a<=85; } else if (c === 'time') { const t = Utils.parseTime(el.value); ok = !isNaN(t) && t>=12 && t<=90; }
          if (!ok) { err.innerText = c==='name'? '> M√çNIMO 2 CARACTERES_' : c==='age'? '> EDAD DEBE SER 14-85_' : '> FORMATO MM:SS (12-90 MIN)_'; err.classList.add('visible'); el.classList.add('error'); } 
          else { err.classList.remove('visible'); el.classList.remove('error'); el.style.transform = "scale(1.02)"; setTimeout(()=>el.style.transform="",200); }
          return ok;
        },
        validarTodo() {
          const n = this.validarCampo('name'), a = this.validarCampo('age'), t = this.validarCampo('time');
          document.getElementById("calcBtn").disabled = !(n && a && t);
        },
        switchTab(tab) {
          document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
          const btns = document.querySelectorAll('.tab-button');
          for (let b of btns) {
            if (b.textContent.includes(tab==='entreno'?'ENTRENO':tab==='plan'?'PLAN':tab==='historial'?'HISTORIAL':'SOPORTE')) {
              b.classList.add('active'); break;
            }
          }
          document.getElementById(`tab-${tab}`).classList.add('active');
          if (tab === 'historial') this.cargarHistorial();
          if (tab === 'soporte') {
            this.cargarMensajesRecibidos();
            this.cargarMensajesEnviados();
          }
        },
        async cargarHistorial() {
          const cont = document.getElementById("historialContainer");
          if (!AppState.currentUser) { cont.innerHTML = '<p style="text-align:center; padding:20px; color: var(--text-secondary);">üì≠ SIN USUARIO</p>'; return; }
          const hist = await Storage.getHistorial(AppState.currentUser);
          if (!hist.length) { cont.innerHTML = '<p style="text-align:center; padding:20px; color: var(--text-secondary);">üì≠ SIN HISTORIAL</p>'; return; }
          let html = '<div class="historial-list">';
          hist.forEach((it,i) => {
            html += `<div class="historial-item">
              <div class="fecha">
                <div class="fecha-linea">
                  <span>üìÖ ${it.date}</span>
                  <span class="hora">${it.hora||''}</span>
                </div>
              </div>
              <div class="resumen">${it.resumen||it.nombre+' ¬∑ '+it.edad+' a√±os'}</div>
              ${it.predicciones ? `<div class="predicciones">üìä ${it.predicciones}</div>` : ''}
              ${it.zonasResumen ? `<div class="zonas-resumen">‚ù§Ô∏è ${it.zonasResumen}</div>` : ''}
              <button class="delete-single" onclick="window.borrarEntradaHistorial(${i})">üóëÔ∏è BORRAR</button>
            </div>`;
          });
          html += '</div>';
          cont.innerHTML = html;
        },
        async borrarEntradaHistorial(i) {
          if (!AppState.currentUser) return;
          if (!confirm("> ¬øELIMINAR ESTA ENTRADA?_")) return;
          let hist = await Storage.getHistorial(AppState.currentUser);
          hist.splice(i,1);
          await Storage.saveHistorial(AppState.currentUser, hist);
          this.cargarHistorial();
          alert("‚úÖ ENTRADA ELIMINADA");
        },
        async borrarHistorial() {
          if (!AppState.currentUser) return;
          if (!confirm("> ¬øELIMINAR TODO EL HISTORIAL?_")) return;
          await Storage.saveHistorial(AppState.currentUser, []);
          this.cargarHistorial();
          alert("‚úÖ HISTORIAL LIMPIO");
        },
        async cargarMensajesRecibidos() {
          if (!AppState.currentUser) return;
          const msgs = await Storage.getMensajesUsuario(AppState.currentUser);
          let html = '';
          msgs.forEach((m, idx) => {
            const esNuevo = !m.leido ? 'nuevo' : '';
            html += `
              <div class="mensaje-item ${esNuevo}" data-indice="${idx}">
                <div class="mensaje-header" onclick="window.toggleMensajeRecibido(this, ${idx})">
                  <span>üì® ${m.fecha} ¬∑ Admin</span>
                  <span class="flecha">‚ñº</span>
                </div>
                <div class="mensaje-contenido">${m.texto}</div>
              </div>
            `;
          });
          document.getElementById('listaMensajesRecibidos').innerHTML = html || '<p>üì≠ NO HAY MENSAJES</p>';
          this.actualizarBadgeMensajes();
        },
        async cargarMensajesEnviados() {
          if (!AppState.currentUser) return;
          const msgs = await Storage.getMensajesEnviadosUsuario(AppState.currentUser);
          let html = '';
          msgs.forEach((m, idx) => {
            html += `
              <div class="mensaje-item">
                <div class="mensaje-header" onclick="this.parentNode.classList.toggle('abierto')">
                  <span>üì§ ${m.fecha} ¬∑ T√∫</span>
                  <span class="flecha">‚ñº</span>
                </div>
                <div class="mensaje-contenido">${m.texto}</div>
              </div>
            `;
          });
          document.getElementById('listaMensajesEnviados').innerHTML = html || '<p>üì≠ NO HAS ENVIADO MENSAJES</p>';
        },
        async toggleMensajeRecibido(header, idx) {
          const item = header.closest('.mensaje-item');
          item.classList.toggle('abierto');
          if (item.classList.contains('nuevo') && item.classList.contains('abierto')) {
            item.classList.remove('nuevo');
            if (AppState.currentUser) {
              await Storage.marcarLeido(AppState.currentUser, idx);
              const msgs = await Storage.getMensajesUsuario(AppState.currentUser);
              AppState.mensajesNoLeidos = msgs.filter(m => !m.leido).length;
              this.actualizarBadgeMensajes();
            }
          }
        },
        async enviarMensajeUsuario() {
          if (!AppState.currentUser) return;
          const texto = document.getElementById('mensajeUsuario').value.trim();
          if (!texto) return alert('> ESCRIBE UN MENSAJE_');
          await Storage.enviarMensajeUsuario(AppState.currentUser, texto);
          document.getElementById('mensajeUsuario').value = '';
          this.cargarMensajesEnviados();
          alert('‚úÖ MENSAJE ENVIADO AL ADMIN');
        },
        cambiarSoporteTab(tab) {
          document.querySelectorAll('#tab-soporte .soporte-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('#tab-soporte .soporte-panel').forEach(p => p.classList.remove('active'));
          if (tab === 'recibidos') {
            document.querySelectorAll('#tab-soporte .soporte-tab')[0].classList.add('active');
            document.getElementById('soporte-recibidos').classList.add('active');
          } else {
            document.querySelectorAll('#tab-soporte .soporte-tab')[1].classList.add('active');
            document.getElementById('soporte-enviados').classList.add('active');
          }
        },
        actualizarBadgeMensajes() {
          const b = document.getElementById('mensajesBadge');
          if (AppState.mensajesNoLeidos > 0) {
            b.style.display = 'inline-block';
            b.innerText = AppState.mensajesNoLeidos;
          } else {
            b.style.display = 'none';
          }
        },
        cerrarModalSesion() {
          const m = document.getElementById("detalleSesion"), o = document.getElementById("modalOverlay");
          m.classList.remove("visible"); o.classList.remove("visible");
          setTimeout(() => m.style.display = "none", 350);
        },
        cerrarPlan() {
          document.getElementById("calendarioEntreno").style.display = "none";
          document.getElementById("guardarPlanBtn").style.display = "none";
          AppState.planGeneradoActual = null;
        }
      };

      window.toggleMensajeRecibido = UI.toggleMensajeRecibido.bind(UI);
      window.enviarMensajeUsuario = UI.enviarMensajeUsuario.bind(UI);
      window.cambiarSoporteTab = UI.cambiarSoporteTab.bind(UI);

      // ==================== M√ìDULO PLAN GENERATOR (con matriz completa) ====================
      const PlanGenerator = {
        ENTRENAMIENTOS_DB: {
          runner: {
            "2k": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje suave", duracion: 25, unidad: "min", desc: "Sesi√≥n muy suave para activaci√≥n.", estructura: "10' calentamiento + 15' Z2", sensacion: "Muy c√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Fondo aer√≥bico", duracion: 30, unidad: "min", desc: "Mant√©n ritmo constante aer√≥bico.", estructura: "5' calentamiento + 20' Z2 + 5' enfriamiento", sensacion: "C√≥modo pero constante", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje progresivo", duracion: 30, unidad: "min", desc: "√öltimos 10' aumenta ritmo.", estructura: "10' Z2 suave + 10' Z2 medio + 10' Z2 alto", sensacion: "Acabar con ganas", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 200m", duracion: 35, unidad: "min", desc: "8x200m con recuperaci√≥n completa.", estructura: "15' calentamiento + 8x200m (rec 1') + 10' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z4" },
                  { nombre: "Fartlek principiante", duracion: 30, unidad: "min", desc: "Juega con ritmos: 2' r√°pido + 2' suave.", estructura: "10' calentamiento + 10' fartlek + 10' enfriamiento", sensacion: "Divertido", tipo: "series", zona: "Z4" },
                  { nombre: "Series 150m", duracion: 30, unidad: "min", desc: "10x150m con recuperaci√≥n 45''.", estructura: "15' calentamiento + 10x150m + 5' enfriamiento", sensacion: "Explosivas", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo corto", duracion: 30, unidad: "min", desc: "Ritmo constante en tempo.", estructura: "10' calentamiento + 15' Z3 + 5' enfriamiento", sensacion: "Controlado", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 35, unidad: "min", desc: "Aumenta ritmo cada 5'.", estructura: "10' calentamiento + 5' Z3 + 5' Z4 + 5' Z3 + 5' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z3-Z4" },
                  { nombre: "Tempo umbral", duracion: 35, unidad: "min", desc: "20' a ritmo umbral.", estructura: "10' calentamiento + 20' Z4 + 5' enfriamiento", sensacion: "Fuerte", tipo: "tempo", zona: "Z4" }
                ],
                largo: [
                  { nombre: "Largo base", duracion: 45, unidad: "min", desc: "Primera toma de contacto con volumen.", estructura: "10' calentamiento + 30' Z2 + 5' enfriamiento", sensacion: "Con energ√≠a", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con cambios", duracion: 50, unidad: "min", desc: "√öltimos 15' a ritmo tempo.", estructura: "25' Z2 + 15' Z3 + 10' enfriamiento", sensacion: "Terminar fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo resistencia", duracion: 55, unidad: "min", desc: "Trabajo de fondo.", estructura: "55' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje activo", duracion: 35, unidad: "min", desc: "Ritmo vivo dentro de Z2.", estructura: "10' calentamiento + 20' Z2 vivo + 5' enfriamiento", sensacion: "Sostenible", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje calidad", duracion: 40, unidad: "min", desc: "Ritmo sostenido en Z2 alto.", estructura: "40' Z2 continuo", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje aer√≥bico", duracion: 45, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "45' Z2 constante", sensacion: "Fluido", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 400m", duracion: 40, unidad: "min", desc: "6x400m con recuperaci√≥n 2'.", estructura: "15' calentamiento + 6x400m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Series 600m", duracion: 45, unidad: "min", desc: "5x600m con recuperaci√≥n 2'30.", estructura: "15' calentamiento + 5x600m + 10' enfriamiento", sensacion: "Intenso", tipo: "series", zona: "Z4" },
                  { nombre: "Pir√°mide", duracion: 45, unidad: "min", desc: "200-400-600-400-200m.", estructura: "15' calentamiento + pir√°mide + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4-Z5" }
                ],
                tempo: [
                  { nombre: "Tempo sostenido", duracion: 35, unidad: "min", desc: "20' a ritmo de tempo.", estructura: "10' calentamiento + 20' tempo + 5' enfriamiento", sensacion: "Continuo", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo umbral", duracion: 40, unidad: "min", desc: "25' a ritmo umbral.", estructura: "10' calentamiento + 25' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 40, unidad: "min", desc: "Alterna 5' Z3 / 3' Z4.", estructura: "10' calentamiento + 4x(5' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo con cambios", duracion: 50, unidad: "min", desc: "√öltimos 15' a ritmo tempo.", estructura: "25' Z2 + 15' Z3 + 10' enfriamiento", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo progresivo", duracion: 55, unidad: "min", desc: "De Z2 a Z4 progresivamente.", estructura: "20' Z2 + 20' Z3 + 15' Z4", sensacion: "Simulaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo fondo", duracion: 60, unidad: "min", desc: "Fondo largo.", estructura: "60' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje calidad", duracion: 40, unidad: "min", desc: "Ritmo sostenido en Z2 alto.", estructura: "40' Z2 continuo", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje activo", duracion: 45, unidad: "min", desc: "Ritmo vivo exigente.", estructura: "45' Z2 vivo", sensacion: "Sostenible", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje t√©cnico", duracion: 50, unidad: "min", desc: "Enfoque en cadencia.", estructura: "50' Z2 con cadencia alta", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 800m", duracion: 45, unidad: "min", desc: "5x800m con recuperaci√≥n 3'.", estructura: "15' calentamiento + 5x800m + 10' enfriamiento", sensacion: "Intenso", tipo: "series", zona: "Z5" },
                  { nombre: "Series 1000m", duracion: 50, unidad: "min", desc: "4x1000m con recuperaci√≥n 3'.", estructura: "15' calentamiento + 4x1000m + 10' enfriamiento", sensacion: "Muy intenso", tipo: "series", zona: "Z5" },
                  { nombre: "Series 1200m", duracion: 55, unidad: "min", desc: "3x1200m con recuperaci√≥n 3'30.", estructura: "15' calentamiento + 3x1200m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo largo", duracion: 40, unidad: "min", desc: "25' a ritmo umbral.", estructura: "10' calentamiento + 25' Z4 + 5' enfriamiento", sensacion: "Umbral", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo umbral", duracion: 45, unidad: "min", desc: "30' a ritmo umbral.", estructura: "10' calentamiento + 30' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 45, unidad: "min", desc: "Alterna 3' Z3 / 3' Z4.", estructura: "10' calentamiento + 5x(3' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo progresivo", duracion: 55, unidad: "min", desc: "De Z2 a Z4 progresivamente.", estructura: "20' Z2 + 20' Z3 + 15' Z4", sensacion: "Simulaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo espec√≠fico", duracion: 60, unidad: "min", desc: "Incluye cambios de ritmo.", estructura: "40' Z2 + 4x3' Z4 + 8' enfriamiento", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo calidad", duracion: 65, unidad: "min", desc: "Progresi√≥n constante.", estructura: "30' Z2 + 20' Z3 + 15' Z4", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" }
                ]
              }
            },
            "5k": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje 5k", duracion: 35, unidad: "min", desc: "Rodaje suave para 5k.", estructura: "10' calentamiento + 20' Z2 + 5' enfriamiento", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Fondo 5k", duracion: 40, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "40' Z2 continuo", sensacion: "Constante", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje progresivo 5k", duracion: 40, unidad: "min", desc: "Aumenta ritmo cada 10'.", estructura: "10' calentamiento + 20' progresivo + 10' enfriamiento", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 300m", duracion: 40, unidad: "min", desc: "8x300m con recuperaci√≥n.", estructura: "15' calentamiento + 8x300m + 10' enfriamiento", sensacion: "Velocidad", tipo: "series", zona: "Z4" },
                  { nombre: "Fartlek 5k", duracion: 35, unidad: "min", desc: "1' r√°pido + 2' suave.", estructura: "10' calentamiento + 8 repeticiones + 5' enfriamiento", sensacion: "Din√°mico", tipo: "series", zona: "Z4" },
                  { nombre: "Series 200m", duracion: 35, unidad: "min", desc: "10x200m con recuperaci√≥n 1'.", estructura: "15' calentamiento + 10x200m + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo 5k", duracion: 35, unidad: "min", desc: "15' a ritmo tempo.", estructura: "10' calentamiento + 15' Z3 + 10' enfriamiento", sensacion: "Constante", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo corto", duracion: 30, unidad: "min", desc: "12' a ritmo tempo.", estructura: "10' calentamiento + 12' Z3 + 8' enfriamiento", sensacion: "Controlado", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 40, unidad: "min", desc: "Aumenta ritmo cada 5'.", estructura: "10' calentamiento + 5' Z2 + 5' Z3 + 5' Z4 + 5' Z3 + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z2-Z4" }
                ],
                largo: [
                  { nombre: "Largo 5k", duracion: 50, unidad: "min", desc: "Rodaje largo resistencia.", estructura: "50' Z2 continuo", sensacion: "Base", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con cambios", duracion: 55, unidad: "min", desc: "√öltimos 15' m√°s r√°pido.", estructura: "40' Z2 + 15' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo fondo", duracion: 60, unidad: "min", desc: "Fondo largo.", estructura: "60' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje activo 5k", duracion: 40, unidad: "min", desc: "Ritmo vivo controlado.", estructura: "40' Z2 vivo", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje calidad", duracion: 45, unidad: "min", desc: "Ritmo exigente.", estructura: "45' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje aer√≥bico", duracion: 50, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "50' Z2 constante", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 600m", duracion: 45, unidad: "min", desc: "6x600m con recuperaci√≥n.", estructura: "15' calentamiento + 6x600m + 10' enfriamiento", sensacion: "Intensidad", tipo: "series", zona: "Z4" },
                  { nombre: "Series 800m", duracion: 50, unidad: "min", desc: "5x800m con recuperaci√≥n 2'30.", estructura: "15' calentamiento + 5x800m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Pir√°mide 5k", duracion: 50, unidad: "min", desc: "200-400-600-800-600-400-200m.", estructura: "15' calentamiento + pir√°mide + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4-Z5" }
                ],
                tempo: [
                  { nombre: "Tempo umbral", duracion: 40, unidad: "min", desc: "20' a ritmo umbral.", estructura: "10' calentamiento + 20' umbral + 10' enfriamiento", sensacion: "Sostenido", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo 5k", duracion: 45, unidad: "min", desc: "25' a ritmo umbral.", estructura: "10' calentamiento + 25' Z4 + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 45, unidad: "min", desc: "Alterna 5' Z3 / 3' Z4.", estructura: "10' calentamiento + 3x(5' Z3 + 3' Z4) + 2' Z3 + 10' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo calidad", duracion: 60, unidad: "min", desc: "Progresi√≥n √∫ltimos 20'.", estructura: "40' Z2 + 20' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con cambios", duracion: 65, unidad: "min", desc: "Incluye series cortas.", estructura: "45' Z2 + 4x3' Z4 + 8' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo progresivo", duracion: 70, unidad: "min", desc: "Aumenta ritmo cada 20'.", estructura: "30' Z2 + 20' Z3 + 20' Z2", sensacion: "Controlado", tipo: "largo", zona: "Z2-Z3" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje alto", duracion: 45, unidad: "min", desc: "Ritmo exigente Z2.", estructura: "45' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje activo", duracion: 50, unidad: "min", desc: "Ritmo vivo.", estructura: "50' Z2 vivo", sensacion: "Sostenible", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje t√©cnico", duracion: 55, unidad: "min", desc: "Enfoque en cadencia.", estructura: "55' Z2 cadencia alta", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 1000m", duracion: 50, unidad: "min", desc: "5x1000m con recuperaci√≥n.", estructura: "15' calentamiento + 5x1000m + 10' enfriamiento", sensacion: "Muy intenso", tipo: "series", zona: "Z5" },
                  { nombre: "Series 1200m", duracion: 55, unidad: "min", desc: "4x1200m con recuperaci√≥n 3'30.", estructura: "15' calentamiento + 4x1200m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Series 1600m", duracion: 60, unidad: "min", desc: "3x1600m con recuperaci√≥n 4'.", estructura: "15' calentamiento + 3x1600m + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo competici√≥n", duracion: 45, unidad: "min", desc: "30' a ritmo 5k.", estructura: "10' calentamiento + 30' Z4 + 5' enfriamiento", sensacion: "Ritmo carrera", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo umbral", duracion: 50, unidad: "min", desc: "35' a ritmo umbral.", estructura: "10' calentamiento + 35' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 50, unidad: "min", desc: "Alterna 4' Z3 / 3' Z4.", estructura: "10' calentamiento + 5x(4' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo espec√≠fico", duracion: 70, unidad: "min", desc: "Cambios a ritmo 5k.", estructura: "40' Z2 + 4x5' Z4 + 10' enfriamiento", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo calidad", duracion: 75, unidad: "min", desc: "Progresi√≥n constante.", estructura: "45' Z2 + 30' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con series", duracion: 80, unidad: "min", desc: "Incluye series largas.", estructura: "50' Z2 + 3x1000m Z4 + 15' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" }
                ]
              }
            },
            "10k": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje 10k", duracion: 40, unidad: "min", desc: "Rodaje suave 10k.", estructura: "10' calentamiento + 25' Z2 + 5' enfriamiento", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Fondo 10k", duracion: 45, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "45' Z2 continuo", sensacion: "Constante", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje progresivo", duracion: 45, unidad: "min", desc: "Aumenta ritmo cada 15'.", estructura: "10' calentamiento + 25' progresivo + 10' enfriamiento", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 400m", duracion: 40, unidad: "min", desc: "8x400m con recuperaci√≥n.", estructura: "15' calentamiento + 8x400m + 10' enfriamiento", sensacion: "Controladas", tipo: "series", zona: "Z4" },
                  { nombre: "Fartlek 10k", duracion: 40, unidad: "min", desc: "2' r√°pido + 2' suave.", estructura: "10' calentamiento + 7 repeticiones + 5' enfriamiento", sensacion: "Din√°mico", tipo: "series", zona: "Z4" },
                  { nombre: "Series 300m", duracion: 35, unidad: "min", desc: "10x300m con recuperaci√≥n 1'.", estructura: "15' calentamiento + 10x300m + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo 10k", duracion: 40, unidad: "min", desc: "20' a ritmo tempo.", estructura: "10' calentamiento + 20' Z3 + 10' enfriamiento", sensacion: "Constante", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo corto", duracion: 35, unidad: "min", desc: "15' a ritmo tempo.", estructura: "10' calentamiento + 15' Z3 + 10' enfriamiento", sensacion: "Controlado", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 45, unidad: "min", desc: "Aumenta cada 7'30.", estructura: "10' calentamiento + 7'30 Z3 + 7'30 Z4 + 7'30 Z3 + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo 10k", duracion: 60, unidad: "min", desc: "Rodaje largo.", estructura: "60' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con cambios", duracion: 65, unidad: "min", desc: "√öltimos 20' m√°s r√°pido.", estructura: "45' Z2 + 20' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo fondo", duracion: 70, unidad: "min", desc: "Fondo largo.", estructura: "70' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje activo 10k", duracion: 45, unidad: "min", desc: "Ritmo vivo Z2.", estructura: "45' Z2 vivo", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje calidad", duracion: 50, unidad: "min", desc: "Ritmo exigente.", estructura: "50' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje aer√≥bico", duracion: 55, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "55' Z2 constante", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 800m", duracion: 50, unidad: "min", desc: "6x800m con recuperaci√≥n.", estructura: "15' calentamiento + 6x800m + 10' enfriamiento", sensacion: "Intensidad", tipo: "series", zona: "Z4" },
                  { nombre: "Series 1000m", duracion: 55, unidad: "min", desc: "5x1000m con recuperaci√≥n 2'30.", estructura: "15' calentamiento + 5x1000m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Pir√°mide 10k", duracion: 55, unidad: "min", desc: "400-800-1200-800-400m.", estructura: "15' calentamiento + pir√°mide + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4-Z5" }
                ],
                tempo: [
                  { nombre: "Tempo umbral", duracion: 45, unidad: "min", desc: "25' a ritmo umbral.", estructura: "10' calentamiento + 25' umbral + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo 10k", duracion: 50, unidad: "min", desc: "30' a ritmo umbral.", estructura: "10' calentamiento + 30' Z4 + 10' enfriamiento", sensacion: "Sostenido", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 50, unidad: "min", desc: "Alterna 6' Z3 / 3' Z4.", estructura: "10' calentamiento + 4x(6' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo calidad", duracion: 75, unidad: "min", desc: "Progresi√≥n √∫ltimos 25'.", estructura: "50' Z2 + 25' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con cambios", duracion: 80, unidad: "min", desc: "Incluye series.", estructura: "55' Z2 + 5x3' Z4 + 10' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo progresivo", duracion: 85, unidad: "min", desc: "Aumenta ritmo cada 25'.", estructura: "35' Z2 + 25' Z3 + 25' Z2", sensacion: "Controlado", tipo: "largo", zona: "Z2-Z3" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje alto", duracion: 50, unidad: "min", desc: "Ritmo exigente Z2.", estructura: "50' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje activo", duracion: 55, unidad: "min", desc: "Ritmo vivo.", estructura: "55' Z2 vivo", sensacion: "Sostenible", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje t√©cnico", duracion: 60, unidad: "min", desc: "Enfoque t√©cnico.", estructura: "60' Z2 cadencia alta", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 1600m", duracion: 55, unidad: "min", desc: "4x1600m con recuperaci√≥n.", estructura: "15' calentamiento + 4x1600m + 10' enfriamiento", sensacion: "Muy intenso", tipo: "series", zona: "Z5" },
                  { nombre: "Series 2000m", duracion: 60, unidad: "min", desc: "3x2000m con recuperaci√≥n 4'.", estructura: "15' calentamiento + 3x2000m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Series 3000m", duracion: 65, unidad: "min", desc: "2x3000m con recuperaci√≥n 5'.", estructura: "15' calentamiento + 2x3000m + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo 10k", duracion: 50, unidad: "min", desc: "35' a ritmo 10k.", estructura: "10' calentamiento + 35' Z4 + 5' enfriamiento", sensacion: "Ritmo carrera", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo umbral", duracion: 55, unidad: "min", desc: "40' a ritmo umbral.", estructura: "10' calentamiento + 40' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 55, unidad: "min", desc: "Alterna 5' Z3 / 3' Z4.", estructura: "10' calentamiento + 5x(5' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo espec√≠fico", duracion: 85, unidad: "min", desc: "Cambios a ritmo 10k.", estructura: "45' Z2 + 5x5' Z4 + 15' enfriamiento", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo calidad", duracion: 90, unidad: "min", desc: "Progresi√≥n constante.", estructura: "50' Z2 + 40' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con series", duracion: 95, unidad: "min", desc: "Series largas.", estructura: "55' Z2 + 4x1000m Z4 + 20' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" }
                ]
              }
            },
            "medio": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje media", duracion: 45, unidad: "min", desc: "Rodaje suave media.", estructura: "10' calentamiento + 30' Z2 + 5' enfriamiento", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Fondo media", duracion: 50, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "50' Z2 continuo", sensacion: "Constante", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje progresivo", duracion: 50, unidad: "min", desc: "Aumenta cada 15'.", estructura: "10' calentamiento + 30' progresivo + 10' enfriamiento", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 500m", duracion: 45, unidad: "min", desc: "8x500m con recuperaci√≥n.", estructura: "15' calentamiento + 8x500m + 10' enfriamiento", sensacion: "Controladas", tipo: "series", zona: "Z4" },
                  { nombre: "Fartlek media", duracion: 45, unidad: "min", desc: "2' r√°pido + 2' suave.", estructura: "10' calentamiento + 8 repeticiones + 7' enfriamiento", sensacion: "Din√°mico", tipo: "series", zona: "Z4" },
                  { nombre: "Series 400m", duracion: 40, unidad: "min", desc: "10x400m con recuperaci√≥n 1'15.", estructura: "15' calentamiento + 10x400m + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo media", duracion: 45, unidad: "min", desc: "25' a ritmo tempo.", estructura: "10' calentamiento + 25' Z3 + 10' enfriamiento", sensacion: "Constante", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 50, unidad: "min", desc: "Aumenta cada 8'.", estructura: "10' calentamiento + 8' Z3 + 8' Z4 + 8' Z3 + 6' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z3-Z4" },
                  { nombre: "Tempo corto", duracion: 40, unidad: "min", desc: "20' a ritmo tempo.", estructura: "10' calentamiento + 20' Z3 + 10' enfriamiento", sensacion: "Controlado", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo media", duracion: 75, unidad: "min", desc: "Rodaje largo.", estructura: "75' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con cambios", duracion: 80, unidad: "min", desc: "√öltimos 25' m√°s r√°pido.", estructura: "55' Z2 + 25' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo fondo", duracion: 85, unidad: "min", desc: "Fondo largo.", estructura: "85' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje activo media", duracion: 50, unidad: "min", desc: "Ritmo vivo Z2.", estructura: "50' Z2 vivo", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje calidad", duracion: 55, unidad: "min", desc: "Ritmo exigente.", estructura: "55' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje aer√≥bico", duracion: 60, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "60' Z2 constante", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 1000m", duracion: 55, unidad: "min", desc: "6x1000m con recuperaci√≥n.", estructura: "15' calentamiento + 6x1000m + 10' enfriamiento", sensacion: "Intensidad", tipo: "series", zona: "Z4" },
                  { nombre: "Series 1200m", duracion: 60, unidad: "min", desc: "5x1200m con recuperaci√≥n 3'.", estructura: "15' calentamiento + 5x1200m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Pir√°mide media", duracion: 60, unidad: "min", desc: "400-800-1200-1600-1200-800-400m.", estructura: "15' calentamiento + pir√°mide + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4-Z5" }
                ],
                tempo: [
                  { nombre: "Tempo umbral media", duracion: 50, unidad: "min", desc: "30' a ritmo umbral.", estructura: "10' calentamiento + 30' umbral + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo media", duracion: 55, unidad: "min", desc: "35' a ritmo umbral.", estructura: "10' calentamiento + 35' Z4 + 10' enfriamiento", sensacion: "Sostenido", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 55, unidad: "min", desc: "Alterna 7' Z3 / 3' Z4.", estructura: "10' calentamiento + 4x(7' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo calidad media", duracion: 90, unidad: "min", desc: "Progresi√≥n √∫ltimos 30'.", estructura: "60' Z2 + 30' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con cambios", duracion: 95, unidad: "min", desc: "Incluye series.", estructura: "65' Z2 + 6x3' Z4 + 12' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo progresivo", duracion: 100, unidad: "min", desc: "Aumenta ritmo cada 30'.", estructura: "40' Z2 + 30' Z3 + 30' Z2", sensacion: "Controlado", tipo: "largo", zona: "Z2-Z3" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje alto media", duracion: 55, unidad: "min", desc: "Ritmo exigente Z2.", estructura: "55' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje activo", duracion: 60, unidad: "min", desc: "Ritmo vivo.", estructura: "60' Z2 vivo", sensacion: "Sostenible", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje t√©cnico", duracion: 65, unidad: "min", desc: "Enfoque t√©cnico.", estructura: "65' Z2 cadencia alta", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 2000m", duracion: 60, unidad: "min", desc: "4x2000m con recuperaci√≥n.", estructura: "15' calentamiento + 4x2000m + 10' enfriamiento", sensacion: "Muy intenso", tipo: "series", zona: "Z5" },
                  { nombre: "Series 3000m", duracion: 65, unidad: "min", desc: "3x3000m con recuperaci√≥n 4'30.", estructura: "15' calentamiento + 3x3000m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Series 5000m", duracion: 70, unidad: "min", desc: "2x5000m con recuperaci√≥n 5'.", estructura: "15' calentamiento + 2x5000m + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo media avanzado", duracion: 55, unidad: "min", desc: "40' a ritmo media.", estructura: "10' calentamiento + 40' Z4 + 5' enfriamiento", sensacion: "Ritmo carrera", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo umbral", duracion: 60, unidad: "min", desc: "45' a ritmo umbral.", estructura: "10' calentamiento + 45' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 60, unidad: "min", desc: "Alterna 6' Z3 / 3' Z4.", estructura: "10' calentamiento + 5x(6' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo espec√≠fico media", duracion: 105, unidad: "min", desc: "Cambios a ritmo media.", estructura: "60' Z2 + 6x5' Z4 + 15' enfriamiento", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo calidad", duracion: 110, unidad: "min", desc: "Progresi√≥n constante.", estructura: "70' Z2 + 40' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con series", duracion: 115, unidad: "min", desc: "Series largas.", estructura: "75' Z2 + 5x1000m Z4 + 20' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" }
                ]
              }
            },
            "maraton": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje marat√≥n", duracion: 50, unidad: "min", desc: "Rodaje suave marat√≥n.", estructura: "10' calentamiento + 35' Z2 + 5' enfriamiento", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Fondo marat√≥n", duracion: 55, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "55' Z2 continuo", sensacion: "Constante", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje progresivo", duracion: 55, unidad: "min", desc: "Aumenta cada 15'.", estructura: "10' calentamiento + 35' progresivo + 10' enfriamiento", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 800m", duracion: 50, unidad: "min", desc: "6x800m con recuperaci√≥n.", estructura: "15' calentamiento + 6x800m + 10' enfriamiento", sensacion: "Controladas", tipo: "series", zona: "Z4" },
                  { nombre: "Fartlek marat√≥n", duracion: 50, unidad: "min", desc: "3' r√°pido + 3' suave.", estructura: "10' calentamiento + 6 repeticiones + 8' enfriamiento", sensacion: "Din√°mico", tipo: "series", zona: "Z4" },
                  { nombre: "Series 1000m", duracion: 55, unidad: "min", desc: "5x1000m con recuperaci√≥n 2'.", estructura: "15' calentamiento + 5x1000m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo marat√≥n", duracion: 50, unidad: "min", desc: "30' a ritmo tempo.", estructura: "10' calentamiento + 30' Z3 + 10' enfriamiento", sensacion: "Constante", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 55, unidad: "min", desc: "Aumenta cada 10'.", estructura: "10' calentamiento + 10' Z3 + 10' Z4 + 10' Z3 + 15' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z3-Z4" },
                  { nombre: "Tempo largo", duracion: 60, unidad: "min", desc: "35' a ritmo tempo.", estructura: "10' calentamiento + 35' Z3 + 15' enfriamiento", sensacion: "Sostenido", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo marat√≥n", duracion: 90, unidad: "min", desc: "Rodaje largo.", estructura: "90' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con cambios", duracion: 100, unidad: "min", desc: "√öltimos 30' m√°s r√°pido.", estructura: "70' Z2 + 30' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo fondo", duracion: 110, unidad: "min", desc: "Fondo largo.", estructura: "110' Z2 continuo", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje activo marat√≥n", duracion: 55, unidad: "min", desc: "Ritmo vivo Z2.", estructura: "55' Z2 vivo", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje calidad", duracion: 60, unidad: "min", desc: "Ritmo exigente.", estructura: "60' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje aer√≥bico", duracion: 65, unidad: "min", desc: "Fondo aer√≥bico.", estructura: "65' Z2 constante", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 1600m", duracion: 60, unidad: "min", desc: "5x1600m con recuperaci√≥n.", estructura: "15' calentamiento + 5x1600m + 10' enfriamiento", sensacion: "Intensidad", tipo: "series", zona: "Z4" },
                  { nombre: "Series 2000m", duracion: 65, unidad: "min", desc: "4x2000m con recuperaci√≥n 3'30.", estructura: "15' calentamiento + 4x2000m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Pir√°mide marat√≥n", duracion: 70, unidad: "min", desc: "800-1600-2400-3200-2400-1600-800m.", estructura: "15' calentamiento + pir√°mide + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4-Z5" }
                ],
                tempo: [
                  { nombre: "Tempo umbral marat√≥n", duracion: 55, unidad: "min", desc: "35' a ritmo umbral.", estructura: "10' calentamiento + 35' umbral + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo marat√≥n", duracion: 60, unidad: "min", desc: "40' a ritmo umbral.", estructura: "10' calentamiento + 40' Z4 + 10' enfriamiento", sensacion: "Sostenido", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 60, unidad: "min", desc: "Alterna 8' Z3 / 3' Z4.", estructura: "10' calentamiento + 4x(8' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo calidad marat√≥n", duracion: 120, unidad: "min", desc: "Progresi√≥n √∫ltimos 40'.", estructura: "80' Z2 + 40' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con cambios", duracion: 130, unidad: "min", desc: "Incluye series.", estructura: "90' Z2 + 8x3' Z4 + 16' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo progresivo", duracion: 140, unidad: "min", desc: "Aumenta ritmo cada 40'.", estructura: "60' Z2 + 40' Z3 + 40' Z2", sensacion: "Controlado", tipo: "largo", zona: "Z2-Z3" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje alto marat√≥n", duracion: 60, unidad: "min", desc: "Ritmo exigente Z2.", estructura: "60' Z2 alto", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje activo", duracion: 65, unidad: "min", desc: "Ritmo vivo.", estructura: "65' Z2 vivo", sensacion: "Sostenible", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje t√©cnico", duracion: 70, unidad: "min", desc: "Enfoque t√©cnico.", estructura: "70' Z2 cadencia alta", sensacion: "Eficiente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Series 3000m", duracion: 70, unidad: "min", desc: "4x3000m con recuperaci√≥n.", estructura: "15' calentamiento + 4x3000m + 10' enfriamiento", sensacion: "Muy intenso", tipo: "series", zona: "Z5" },
                  { nombre: "Series 5000m", duracion: 75, unidad: "min", desc: "3x5000m con recuperaci√≥n 5'.", estructura: "15' calentamiento + 3x5000m + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Series 10000m", duracion: 80, unidad: "min", desc: "2x10000m con recuperaci√≥n 6'.", estructura: "15' calentamiento + 2x10000m + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo marat√≥n avanzado", duracion: 60, unidad: "min", desc: "45' a ritmo marat√≥n.", estructura: "10' calentamiento + 45' Z4 + 5' enfriamiento", sensacion: "Ritmo carrera", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo umbral", duracion: 65, unidad: "min", desc: "50' a ritmo umbral.", estructura: "10' calentamiento + 50' Z4 + 5' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z4" },
                  { nombre: "Tempo variable", duracion: 65, unidad: "min", desc: "Alterna 7' Z3 / 3' Z4.", estructura: "10' calentamiento + 5x(7' Z3 + 3' Z4) + 5' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3-Z4" }
                ],
                largo: [
                  { nombre: "Largo espec√≠fico marat√≥n", duracion: 150, unidad: "min", desc: "Cambios a ritmo marat√≥n.", estructura: "90' Z2 + 8x5' Z4 + 20' enfriamiento", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2-Z4" },
                  { nombre: "Largo calidad", duracion: 160, unidad: "min", desc: "Progresi√≥n constante.", estructura: "100' Z2 + 60' Z3", sensacion: "Fuerte", tipo: "largo", zona: "Z2-Z3" },
                  { nombre: "Largo con series", duracion: 170, unidad: "min", desc: "Series largas.", estructura: "110' Z2 + 6x1000m Z4 + 20' enfriamiento", sensacion: "Exigente", tipo: "largo", zona: "Z2-Z4" }
                ]
              }
            }
          },
          trail: {
            "2k": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje sendero", duracion: 30, unidad: "min", desc: "Terreno irregular suave.", estructura: "10' calentamiento + 15' Z2 + 5' enfriamiento", sensacion: "Adaptaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero suave", duracion: 35, unidad: "min", desc: "Terreno variado suave.", estructura: "35' sendero continuo", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero progresivo", duracion: 35, unidad: "min", desc: "Aumenta ritmo en llano.", estructura: "10' calentamiento + 20' progresivo + 5' enfriamiento", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas suaves", duracion: 35, unidad: "min", desc: "4x60m cuesta suave.", estructura: "15' calentamiento + 4 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas cortas", duracion: 30, unidad: "min", desc: "5x50m cuesta suave.", estructura: "15' calentamiento + 5 cuestas + 5' enfriamiento", sensacion: "Explosivas", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas medias", duracion: 40, unidad: "min", desc: "4x80m cuesta media.", estructura: "15' calentamiento + 4 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo sendero", duracion: 35, unidad: "min", desc: "Ritmo sostenido sendero.", estructura: "10' calentamiento + 15' Z3 + 10' enfriamiento", sensacion: "Controlado", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo desnivel suave", duracion: 40, unidad: "min", desc: "Con desnivel suave.", estructura: "10' calentamiento + 20' Z3 + 10' enfriamiento", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 40, unidad: "min", desc: "Aumenta en llano.", estructura: "10' calentamiento + 20' progresivo + 10' enfriamiento", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo sendero", duracion: 50, unidad: "min", desc: "Toma contacto trail.", estructura: "50' Z2 sendero", sensacion: "Adaptaci√≥n", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo monta√±a suave", duracion: 55, unidad: "min", desc: "Sendero continuo.", estructura: "55' sendero", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 60, unidad: "min", desc: "Incluye subidas suaves.", estructura: "60' sendero con desnivel", sensacion: "Exigente", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 40, unidad: "min", desc: "T√©cnica en sendero.", estructura: "40' Z2 t√©cnico", sensacion: "Coordinaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero t√©cnico", duracion: 45, unidad: "min", desc: "T√©cnica avanzada.", estructura: "45' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje monta√±a", duracion: 50, unidad: "min", desc: "Terreno variado.", estructura: "50' sendero variado", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas medias", duracion: 40, unidad: "min", desc: "6x80m cuesta media.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas largas", duracion: 45, unidad: "min", desc: "5x100m cuesta media.", estructura: "15' calentamiento + 5 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas variables", duracion: 45, unidad: "min", desc: "4x(60m + 80m + 100m)", estructura: "15' calentamiento + 4 series + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo desnivel", duracion: 40, unidad: "min", desc: "Incluye subidas.", estructura: "40' con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo monta√±a", duracion: 45, unidad: "min", desc: "Ritmo fuerte.", estructura: "45' desnivel continuo", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 45, unidad: "min", desc: "Alterna llano y cuestas.", estructura: "45' con cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo monta√±a", duracion: 70, unidad: "min", desc: "Mixto subidas/bajadas.", estructura: "70' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo t√©cnico", duracion: 75, unidad: "min", desc: "Alta dificultad t√©cnica.", estructura: "75' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 80, unidad: "min", desc: "Acumulaci√≥n desnivel.", estructura: "80' trail con desnivel", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje monta√±a", duracion: 45, unidad: "min", desc: "Alta dificultad t√©cnica.", estructura: "45' Z2 t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero avanzado", duracion: 50, unidad: "min", desc: "M√°xima t√©cnica.", estructura: "50' t√©cnico", sensacion: "Dominio", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje desnivel", duracion: 55, unidad: "min", desc: "Acumulaci√≥n desnivel.", estructura: "55' con desnivel", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas fuertes", duracion: 45, unidad: "min", desc: "8x100m cuesta fuerte.", estructura: "15' calentamiento + 8 cuestas + 10' enfriamiento", sensacion: "M√°xima potencia", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas muy fuertes", duracion: 50, unidad: "min", desc: "6x120m cuesta fuerte.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas largas fuertes", duracion: 55, unidad: "min", desc: "5x150m cuesta fuerte.", estructura: "15' calentamiento + 5 cuestas + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo monta√±a", duracion: 45, unidad: "min", desc: "Ritmo fuerte desnivel.", estructura: "45' desnivel continuo", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo fuerte", duracion: 50, unidad: "min", desc: "M√°xima intensidad.", estructura: "50' desnivel intenso", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 50, unidad: "min", desc: "Alterna ritmos.", estructura: "50' cambios de ritmo", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo trail", duracion: 90, unidad: "min", desc: "Simulaci√≥n competici√≥n.", estructura: "90' trail cambios", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo avanzado", duracion: 100, unidad: "min", desc: "Alto volumen t√©cnico.", estructura: "100' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo ultra", duracion: 110, unidad: "min", desc: "Preparaci√≥n ultra.", estructura: "110' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              }
            },
            "5k": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje 5k trail", duracion: 35, unidad: "min", desc: "Terreno irregular.", estructura: "35' Z2 sendero", sensacion: "Adaptaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero 5k", duracion: 40, unidad: "min", desc: "Sendero continuo.", estructura: "40' sendero", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero progresivo", duracion: 40, unidad: "min", desc: "Aumenta ritmo.", estructura: "40' progresivo", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas 5k", duracion: 40, unidad: "min", desc: "5x80m cuesta suave.", estructura: "15' calentamiento + 5 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas cortas", duracion: 35, unidad: "min", desc: "6x60m cuesta suave.", estructura: "15' calentamiento + 6 cuestas + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas medias", duracion: 45, unidad: "min", desc: "5x100m cuesta media.", estructura: "15' calentamiento + 5 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo sendero", duracion: 40, unidad: "min", desc: "Ritmo sostenido.", estructura: "40' Z3 sendero", sensacion: "Control", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo desnivel", duracion: 45, unidad: "min", desc: "Con desnivel suave.", estructura: "45' Z3 con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 45, unidad: "min", desc: "Aumenta ritmo.", estructura: "45' progresivo", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo sendero", duracion: 60, unidad: "min", desc: "Resistencia sendero.", estructura: "60' Z2 sendero", sensacion: "Base", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo monta√±a suave", duracion: 65, unidad: "min", desc: "Sendero continuo.", estructura: "65' sendero", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 70, unidad: "min", desc: "Incluye desnivel.", estructura: "70' con desnivel", sensacion: "Exigente", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 40, unidad: "min", desc: "T√©cnica continua.", estructura: "40' t√©cnico", sensacion: "Coordinaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero t√©cnico", duracion: 45, unidad: "min", desc: "T√©cnica avanzada.", estructura: "45' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje monta√±a", duracion: 50, unidad: "min", desc: "Terreno variado.", estructura: "50' sendero variado", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas medias", duracion: 45, unidad: "min", desc: "7x100m cuesta media.", estructura: "15' calentamiento + 7 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas largas", duracion: 50, unidad: "min", desc: "6x120m cuesta media.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas variables", duracion: 50, unidad: "min", desc: "5x(80m + 100m + 120m)", estructura: "15' calentamiento + 5 series + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo desnivel", duracion: 45, unidad: "min", desc: "Desnivel continuo.", estructura: "45' con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo monta√±a", duracion: 50, unidad: "min", desc: "Ritmo fuerte.", estructura: "50' desnivel", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 50, unidad: "min", desc: "Alterna ritmos.", estructura: "50' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo monta√±a", duracion: 75, unidad: "min", desc: "Mixto con cambios.", estructura: "75' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo t√©cnico", duracion: 80, unidad: "min", desc: "Alta t√©cnica.", estructura: "80' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 85, unidad: "min", desc: "Acumulaci√≥n.", estructura: "85' con desnivel", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 45, unidad: "min", desc: "Alta t√©cnica.", estructura: "45' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero avanzado", duracion: 50, unidad: "min", desc: "M√°xima t√©cnica.", estructura: "50' t√©cnico", sensacion: "Dominio", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje desnivel", duracion: 55, unidad: "min", desc: "Acumulaci√≥n.", estructura: "55' con desnivel", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas fuertes", duracion: 50, unidad: "min", desc: "9x120m cuesta fuerte.", estructura: "15' calentamiento + 9 cuestas + 10' enfriamiento", sensacion: "M√°xima potencia", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas muy fuertes", duracion: 55, unidad: "min", desc: "7x150m cuesta fuerte.", estructura: "15' calentamiento + 7 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas largas fuertes", duracion: 60, unidad: "min", desc: "6x180m cuesta fuerte.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo monta√±a", duracion: 50, unidad: "min", desc: "Ritmo fuerte.", estructura: "50' desnivel intenso", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo fuerte", duracion: 55, unidad: "min", desc: "M√°xima intensidad.", estructura: "55' desnivel intenso", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 55, unidad: "min", desc: "Cambios constantes.", estructura: "55' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo trail", duracion: 100, unidad: "min", desc: "Simulaci√≥n carrera.", estructura: "100' trail", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo avanzado", duracion: 110, unidad: "min", desc: "Alto volumen.", estructura: "110' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo ultra", duracion: 120, unidad: "min", desc: "Preparaci√≥n ultra.", estructura: "120' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              }
            },
            "10k": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje 10k trail", duracion: 40, unidad: "min", desc: "Terreno irregular.", estructura: "40' Z2 sendero", sensacion: "Adaptaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero 10k", duracion: 45, unidad: "min", desc: "Sendero continuo.", estructura: "45' sendero", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero progresivo", duracion: 45, unidad: "min", desc: "Aumenta ritmo.", estructura: "45' progresivo", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas 10k", duracion: 45, unidad: "min", desc: "6x80m cuesta suave.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas cortas", duracion: 40, unidad: "min", desc: "7x60m cuesta suave.", estructura: "15' calentamiento + 7 cuestas + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas medias", duracion: 50, unidad: "min", desc: "6x100m cuesta media.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo sendero", duracion: 45, unidad: "min", desc: "Ritmo sostenido.", estructura: "45' Z3 sendero", sensacion: "Control", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo desnivel", duracion: 50, unidad: "min", desc: "Con desnivel suave.", estructura: "50' Z3 con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 50, unidad: "min", desc: "Aumenta ritmo.", estructura: "50' progresivo", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo sendero", duracion: 70, unidad: "min", desc: "Resistencia.", estructura: "70' Z2 sendero", sensacion: "Base", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo monta√±a suave", duracion: 75, unidad: "min", desc: "Sendero continuo.", estructura: "75' sendero", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 80, unidad: "min", desc: "Incluye desnivel.", estructura: "80' con desnivel", sensacion: "Exigente", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 45, unidad: "min", desc: "T√©cnica sendero.", estructura: "45' t√©cnico", sensacion: "Coordinaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero t√©cnico", duracion: 50, unidad: "min", desc: "T√©cnica avanzada.", estructura: "50' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje monta√±a", duracion: 55, unidad: "min", desc: "Terreno variado.", estructura: "55' sendero variado", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas medias", duracion: 50, unidad: "min", desc: "8x100m cuesta media.", estructura: "15' calentamiento + 8 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas largas", duracion: 55, unidad: "min", desc: "7x120m cuesta media.", estructura: "15' calentamiento + 7 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas variables", duracion: 55, unidad: "min", desc: "6x(80m + 100m + 120m)", estructura: "15' calentamiento + 6 series + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo desnivel", duracion: 50, unidad: "min", desc: "Desnivel continuo.", estructura: "50' con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo monta√±a", duracion: 55, unidad: "min", desc: "Ritmo fuerte.", estructura: "55' desnivel", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 55, unidad: "min", desc: "Alterna ritmos.", estructura: "55' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo monta√±a", duracion: 90, unidad: "min", desc: "Mixto trail.", estructura: "90' trail t√©cnico", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo t√©cnico", duracion: 95, unidad: "min", desc: "Alta t√©cnica.", estructura: "95' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 100, unidad: "min", desc: "Acumulaci√≥n.", estructura: "100' con desnivel", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 50, unidad: "min", desc: "M√°xima t√©cnica.", estructura: "50' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero avanzado", duracion: 55, unidad: "min", desc: "T√©cnica superior.", estructura: "55' t√©cnico", sensacion: "Dominio", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje desnivel", duracion: 60, unidad: "min", desc: "Acumulaci√≥n.", estructura: "60' con desnivel", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas fuertes", duracion: 55, unidad: "min", desc: "10x120m cuesta fuerte.", estructura: "15' calentamiento + 10 cuestas + 10' enfriamiento", sensacion: "M√°xima potencia", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas muy fuertes", duracion: 60, unidad: "min", desc: "8x150m cuesta fuerte.", estructura: "15' calentamiento + 8 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas largas fuertes", duracion: 65, unidad: "min", desc: "7x200m cuesta fuerte.", estructura: "15' calentamiento + 7 cuestas + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo monta√±a", duracion: 55, unidad: "min", desc: "Ritmo fuerte.", estructura: "55' desnivel intenso", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo fuerte", duracion: 60, unidad: "min", desc: "M√°xima intensidad.", estructura: "60' desnivel intenso", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 60, unidad: "min", desc: "Cambios constantes.", estructura: "60' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo trail", duracion: 120, unidad: "min", desc: "Simulaci√≥n.", estructura: "120' trail", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo avanzado", duracion: 130, unidad: "min", desc: "Alto volumen.", estructura: "130' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo ultra", duracion: 140, unidad: "min", desc: "Preparaci√≥n.", estructura: "140' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              }
            },
            "medio": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje media trail", duracion: 45, unidad: "min", desc: "Terreno irregular.", estructura: "45' Z2 sendero", sensacion: "Adaptaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero media", duracion: 50, unidad: "min", desc: "Sendero continuo.", estructura: "50' sendero", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero progresivo", duracion: 50, unidad: "min", desc: "Aumenta ritmo.", estructura: "50' progresivo", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas media", duracion: 50, unidad: "min", desc: "7x100m cuesta suave.", estructura: "15' calentamiento + 7 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas cortas", duracion: 45, unidad: "min", desc: "8x70m cuesta suave.", estructura: "15' calentamiento + 8 cuestas + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas medias", duracion: 55, unidad: "min", desc: "6x120m cuesta media.", estructura: "15' calentamiento + 6 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo sendero", duracion: 50, unidad: "min", desc: "Ritmo sostenido.", estructura: "50' Z3 sendero", sensacion: "Control", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo desnivel", duracion: 55, unidad: "min", desc: "Con desnivel suave.", estructura: "55' Z3 con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 55, unidad: "min", desc: "Aumenta ritmo.", estructura: "55' progresivo", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo sendero", duracion: 85, unidad: "min", desc: "Resistencia.", estructura: "85' Z2 sendero", sensacion: "Base", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo monta√±a suave", duracion: 90, unidad: "min", desc: "Sendero continuo.", estructura: "90' sendero", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 95, unidad: "min", desc: "Incluye desnivel.", estructura: "95' con desnivel", sensacion: "Exigente", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 50, unidad: "min", desc: "T√©cnica avanzada.", estructura: "50' t√©cnico", sensacion: "Coordinaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero t√©cnico", duracion: 55, unidad: "min", desc: "T√©cnica superior.", estructura: "55' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje monta√±a", duracion: 60, unidad: "min", desc: "Terreno variado.", estructura: "60' sendero variado", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas medias", duracion: 55, unidad: "min", desc: "9x120m cuesta media.", estructura: "15' calentamiento + 9 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas largas", duracion: 60, unidad: "min", desc: "8x150m cuesta media.", estructura: "15' calentamiento + 8 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas variables", duracion: 60, unidad: "min", desc: "7x(100m + 120m + 150m)", estructura: "15' calentamiento + 7 series + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo desnivel", duracion: 55, unidad: "min", desc: "Desnivel continuo.", estructura: "55' con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo monta√±a", duracion: 60, unidad: "min", desc: "Ritmo fuerte.", estructura: "60' desnivel", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 60, unidad: "min", desc: "Alterna ritmos.", estructura: "60' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo monta√±a", duracion: 105, unidad: "min", desc: "Mixto exigente.", estructura: "105' trail t√©cnico", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo t√©cnico", duracion: 110, unidad: "min", desc: "Alta t√©cnica.", estructura: "110' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 115, unidad: "min", desc: "Acumulaci√≥n.", estructura: "115' con desnivel", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 55, unidad: "min", desc: "M√°xima t√©cnica.", estructura: "55' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero avanzado", duracion: 60, unidad: "min", desc: "T√©cnica elite.", estructura: "60' t√©cnico", sensacion: "Dominio", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje desnivel", duracion: 65, unidad: "min", desc: "Acumulaci√≥n.", estructura: "65' con desnivel", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas fuertes", duracion: 60, unidad: "min", desc: "12x150m cuesta fuerte.", estructura: "15' calentamiento + 12 cuestas + 10' enfriamiento", sensacion: "M√°xima potencia", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas muy fuertes", duracion: 65, unidad: "min", desc: "10x200m cuesta fuerte.", estructura: "15' calentamiento + 10 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas largas fuertes", duracion: 70, unidad: "min", desc: "8x250m cuesta fuerte.", estructura: "15' calentamiento + 8 cuestas + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo monta√±a", duracion: 60, unidad: "min", desc: "Ritmo fuerte.", estructura: "60' desnivel intenso", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo fuerte", duracion: 65, unidad: "min", desc: "M√°xima intensidad.", estructura: "65' desnivel intenso", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 65, unidad: "min", desc: "Cambios constantes.", estructura: "65' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo trail", duracion: 135, unidad: "min", desc: "Simulaci√≥n.", estructura: "135' trail", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo avanzado", duracion: 145, unidad: "min", desc: "Alto volumen.", estructura: "145' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo ultra", duracion: 155, unidad: "min", desc: "Preparaci√≥n ultra.", estructura: "155' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              }
            },
            "maraton": {
              principiante: {
                rodaje: [
                  { nombre: "Rodaje marat√≥n trail", duracion: 50, unidad: "min", desc: "Terreno irregular.", estructura: "50' Z2 sendero", sensacion: "Adaptaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero marat√≥n", duracion: 55, unidad: "min", desc: "Sendero continuo.", estructura: "55' sendero", sensacion: "C√≥modo", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero progresivo", duracion: 55, unidad: "min", desc: "Aumenta ritmo.", estructura: "55' progresivo", sensacion: "Progresivo", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas marat√≥n", duracion: 55, unidad: "min", desc: "8x100m cuesta suave.", estructura: "15' calentamiento + 8 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas cortas", duracion: 50, unidad: "min", desc: "9x80m cuesta suave.", estructura: "15' calentamiento + 9 cuestas + 5' enfriamiento", sensacion: "R√°pidas", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas medias", duracion: 60, unidad: "min", desc: "7x120m cuesta media.", estructura: "15' calentamiento + 7 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo sendero", duracion: 55, unidad: "min", desc: "Ritmo sostenido.", estructura: "55' Z3 sendero", sensacion: "Control", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo desnivel", duracion: 60, unidad: "min", desc: "Con desnivel suave.", estructura: "60' Z3 con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo progresivo", duracion: 60, unidad: "min", desc: "Aumenta ritmo.", estructura: "60' progresivo", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo sendero", duracion: 100, unidad: "min", desc: "Resistencia.", estructura: "100' Z2 sendero", sensacion: "Base", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo monta√±a suave", duracion: 105, unidad: "min", desc: "Sendero continuo.", estructura: "105' sendero", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 110, unidad: "min", desc: "Incluye desnivel.", estructura: "110' con desnivel", sensacion: "Exigente", tipo: "largo", zona: "Z2" }
                ]
              },
              intermedio: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 55, unidad: "min", desc: "T√©cnica avanzada.", estructura: "55' t√©cnico", sensacion: "Coordinaci√≥n", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero t√©cnico", duracion: 60, unidad: "min", desc: "T√©cnica superior.", estructura: "60' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje monta√±a", duracion: 65, unidad: "min", desc: "Terreno variado.", estructura: "65' sendero variado", sensacion: "Resistencia", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas medias", duracion: 60, unidad: "min", desc: "10x150m cuesta media.", estructura: "15' calentamiento + 10 cuestas + 10' enfriamiento", sensacion: "Potencia", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas largas", duracion: 65, unidad: "min", desc: "9x200m cuesta media.", estructura: "15' calentamiento + 9 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z4" },
                  { nombre: "Cuestas variables", duracion: 65, unidad: "min", desc: "8x(120m + 150m + 200m)", estructura: "15' calentamiento + 8 series + 10' enfriamiento", sensacion: "Completo", tipo: "series", zona: "Z4" }
                ],
                tempo: [
                  { nombre: "Tempo desnivel", duracion: 60, unidad: "min", desc: "Desnivel continuo.", estructura: "60' con desnivel", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo monta√±a", duracion: 65, unidad: "min", desc: "Ritmo fuerte.", estructura: "65' desnivel", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 65, unidad: "min", desc: "Alterna ritmos.", estructura: "65' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo monta√±a", duracion: 135, unidad: "min", desc: "Mixto exigente.", estructura: "135' trail t√©cnico", sensacion: "Resistencia", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo t√©cnico", duracion: 140, unidad: "min", desc: "Alta t√©cnica.", estructura: "140' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo con desnivel", duracion: 145, unidad: "min", desc: "Acumulaci√≥n.", estructura: "145' con desnivel", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" }
                ]
              },
              avanzado: {
                rodaje: [
                  { nombre: "Rodaje t√©cnico", duracion: 60, unidad: "min", desc: "M√°xima t√©cnica.", estructura: "60' t√©cnico", sensacion: "Maestr√≠a", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Sendero avanzado", duracion: 65, unidad: "min", desc: "T√©cnica elite.", estructura: "65' t√©cnico", sensacion: "Dominio", tipo: "rodaje", zona: "Z2" },
                  { nombre: "Rodaje desnivel", duracion: 70, unidad: "min", desc: "Acumulaci√≥n.", estructura: "70' con desnivel", sensacion: "Exigente", tipo: "rodaje", zona: "Z2" }
                ],
                series: [
                  { nombre: "Cuestas fuertes", duracion: 70, unidad: "min", desc: "15x200m cuesta fuerte.", estructura: "15' calentamiento + 15 cuestas + 10' enfriamiento", sensacion: "M√°xima potencia", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas muy fuertes", duracion: 75, unidad: "min", desc: "12x250m cuesta fuerte.", estructura: "15' calentamiento + 12 cuestas + 10' enfriamiento", sensacion: "Exigente", tipo: "series", zona: "Z5" },
                  { nombre: "Cuestas largas fuertes", duracion: 80, unidad: "min", desc: "10x300m cuesta fuerte.", estructura: "15' calentamiento + 10 cuestas + 10' enfriamiento", sensacion: "M√°ximo", tipo: "series", zona: "Z5" }
                ],
                tempo: [
                  { nombre: "Tempo monta√±a", duracion: 70, unidad: "min", desc: "Ritmo fuerte.", estructura: "70' desnivel intenso", sensacion: "Exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo fuerte", duracion: 75, unidad: "min", desc: "M√°xima intensidad.", estructura: "75' desnivel intenso", sensacion: "Muy exigente", tipo: "tempo", zona: "Z3" },
                  { nombre: "Tempo variable", duracion: 75, unidad: "min", desc: "Cambios constantes.", estructura: "75' cambios", sensacion: "Din√°mico", tipo: "tempo", zona: "Z3" }
                ],
                largo: [
                  { nombre: "Largo trail", duracion: 180, unidad: "min", desc: "Simulaci√≥n ultratrail.", estructura: "180' trail", sensacion: "Preparaci√≥n", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo avanzado", duracion: 190, unidad: "min", desc: "Alto volumen.", estructura: "190' trail t√©cnico", sensacion: "Exigente", tipo: "largo", zona: "Z2" },
                  { nombre: "Largo ultra", duracion: 200, unidad: "min", desc: "Preparaci√≥n ultra.", estructura: "200' trail", sensacion: "Resistencia", tipo: "largo", zona: "Z2" }
                ]
              }
            }
          }
        },

        toggleCuestionario() {
          if (!AppState.zonasCalculadas) return alert("> CALCULA ZONAS PRIMERO_");
          const q = document.getElementById("cuestionarioEntreno");
          q.style.display = q.style.display === "block" ? "none" : "block";
        },
        async guardarPlanActual() {
          if (!AppState.currentUser) return alert("> NO HAY USUARIO_");
          if (!AppState.planGeneradoActual) return alert("> GENERA UN PLAN PRIMERO_");
          AppState.ultimoPlanParams = { ...AppState.planGeneradoActual };
          await Storage.setUltimoPlan(AppState.currentUser, AppState.ultimoPlanParams);
          const btn = document.getElementById("guardarPlanBtn");
          btn.innerText = "‚úÖ PLAN GUARDADO"; btn.disabled = true;
          btn.style.backgroundColor = "rgba(50, 215, 75, 0.2)";
          setTimeout(() => btn.style.backgroundColor = "", 500);
        },
        async mostrarUltimoPlanGuardado() {
          if (!AppState.currentUser) return alert("> NO HAY USUARIO_");
          const stored = await Storage.getUltimoPlan(AppState.currentUser);
          if (!stored) return alert("> NO HAY PLAN GUARDADO_");
          AppState.ultimoPlanParams = stored;
          document.getElementById("modalidad").value = stored.modalidad;
          document.getElementById("distObjetivo").value = stored.distancia;
          document.getElementById("duracionPlan").value = stored.macrociclo / 4;
          document.getElementById("diasSemana").value = stored.diasPorSemana;
          document.getElementById("nivel").value = stored.nivel;
          document.getElementById("experienciaDistancia").value = stored.experiencia || "no";
          document.getElementById("objetivoPrincipal").value = stored.objetivo || "mejorar";
          document.getElementById("diaLargo").value = stored.diaLargo;
          document.getElementById("fechaInicio").value = stored.fechaInicio || "2025-03-01";
          document.getElementById("cuestionarioEntreno").style.display = "none";
          document.getElementById("calendarioEntreno").style.display = "block";
          this.generarCalendarioEntreno();
        },
        async borrarPlanGuardado() {
          if (!AppState.currentUser) return alert("> NO HAY USUARIO_");
          if (!confirm("> ¬øELIMINAR PLAN GUARDADO?_")) return;
          await Storage.removeUltimoPlan(AppState.currentUser);
          alert("‚úÖ PLAN ELIMINADO");
        },
        getRitmoPorZona(z) {
          if (!AppState.lastRitmoBase) return "Calcula zonas primero";
          const f = { 'Z1':1.35, 'Z2':1.25, 'Z3':1.15, 'Z4':1.05, 'Z5':0.95, 'Z6':0.85 };
          if (z.includes('-')) {
            const [a,b] = z.split('-');
            return `${Utils.formatR(AppState.lastRitmoBase*(f[a]||1.15))} ‚Äì ${Utils.formatR(AppState.lastRitmoBase*(f[b]||1.05))} min/km`;
          }
          return Utils.formatR(AppState.lastRitmoBase*(f[z]||1.15)) + " min/km";
        },
        generarCalendarioEntreno() {
          if (!AppState.zonasCalculadas) return alert("> PRIMERO CALCULA TUS ZONAS DE ENTRENO_");
          const btn = document.querySelector('[onclick="window.generarCalendarioEntreno()"]');
          if (btn) Utils.showLoading(btn);
          setTimeout(() => {
            try {
              const modalidad = document.getElementById("modalidad").value;
              const distancia = document.getElementById("distObjetivo").value;
              const meses = parseInt(document.getElementById("duracionPlan").value);
              const diasSem = parseInt(document.getElementById("diasSemana").value);
              const nivel = document.getElementById("nivel").value;
              const exp = document.getElementById("experienciaDistancia").value;
              const obj = document.getElementById("objetivoPrincipal").value;
              const diaLargo = parseInt(document.getElementById("diaLargo").value);
              const fechaInicio = document.getElementById("fechaInicio").value;
              if (!fechaInicio) return alert("> SELECCIONA UNA FECHA DE INICIO_");
              
              const fecha = new Date(fechaInicio + "T00:00:00");
              const diaInicio = fecha.getDay(); // 0 domingo, 1 lunes, ..., 6 s√°bado
              let diaInicioNum = diaInicio === 0 ? 7 : diaInicio;
              
              const macrociclo = meses * 4;
              const mapa = { "2k":"2 km", "5k":"5 km", "10k":"10 km", "medio":"MEDIA", "maraton":"MARAT√ìN" };
              const diaNombre = ["","LUN","MAR","MI√â","JUE","VIE","S√ÅB","DOM"][diaLargo];
              document.getElementById("resumenObjetivo").innerText = `${mapa[distancia]} ¬∑ ${diasSem} D√çAS/SEM ¬∑ ${nivel.toUpperCase()} ¬∑ ${exp==='si'?'CON EXPERIENCIA':'PRIMERA VEZ'} ¬∑ ${obj==='acabar'?'OBJ: TERMINAR':obj==='mejorar'?'OBJ: MEJORAR':'OBJ: COMPETIR'} ¬∑ LARGO: ${diaNombre} ¬∑ ${modalidad==='runner'?'ASFALTO':'MONTA√ëA'} ¬∑ ${meses} MES(ES) ¬∑ INICIO: ${fecha.toLocaleDateString()}`;

              const grid = document.getElementById("calendarioGrid");
              grid.innerHTML = "";
              const totalDias = macrociclo * 7;
              
              const diasEntreno = [];
              for (let i = 0; i < diasSem; i++) {
                let dia = (diaInicioNum + i - 1) % 7 + 1;
                diasEntreno.push(dia);
              }
              if (!diasEntreno.includes(diaLargo)) {
                diasEntreno.pop();
                diasEntreno.push(diaLargo);
              }
              diasEntreno.sort((a,b) => a - b);

              const usados = { rodaje:{}, series:{}, tempo:{}, largo:{} };
              const fragment = document.createDocumentFragment();

              for (let dia=1; dia<=totalDias; dia++) {
                const semana = Math.floor((dia-1)/7);
                const diaSem = (dia-1)%7 + 1;
                let color = "sesion-descanso", breve = "D", detalle = null;

                if (diasEntreno.includes(diaSem)) {
                  if (diaSem === diaLargo) {
                    const opts = this.ENTRENAMIENTOS_DB[modalidad]?.[distancia]?.[nivel]?.largo;
                    if (opts && opts.length) {
                      const clave = `largo_sem${semana}`;
                      if (!usados.largo[clave]) usados.largo[clave] = 0;
                      const idx = (semana + usados.largo[clave]) % opts.length;
                      detalle = { ...opts[idx], tipo:"largo" };
                      usados.largo[clave]++;
                      color = "sesion-largo"; breve = "L";
                    }
                  } else if (diaSem === 3 || diaSem === 4) {
                    const opts = this.ENTRENAMIENTOS_DB[modalidad]?.[distancia]?.[nivel]?.series;
                    if (opts && opts.length) {
                      const clave = `series_sem${semana}`;
                      if (!usados.series[clave]) usados.series[clave] = 0;
                      const idx = (semana*2 + usados.series[clave]) % opts.length;
                      detalle = { ...opts[idx], tipo:"series" };
                      usados.series[clave]++;
                      color = "sesion-series"; breve = "S";
                    }
                  } else if (diaSem === 5) {
                    const opts = this.ENTRENAMIENTOS_DB[modalidad]?.[distancia]?.[nivel]?.tempo;
                    if (opts && opts.length) {
                      const clave = `tempo_sem${semana}`;
                      if (!usados.tempo[clave]) usados.tempo[clave] = 0;
                      const idx = (semana*3 + usados.tempo[clave]) % opts.length;
                      detalle = { ...opts[idx], tipo:"tempo" };
                      usados.tempo[clave]++;
                      color = "sesion-tempo"; breve = "T";
                    }
                  } else {
                    const opts = this.ENTRENAMIENTOS_DB[modalidad]?.[distancia]?.[nivel]?.rodaje;
                    if (opts && opts.length) {
                      const clave = `rodaje_sem${semana}`;
                      if (!usados.rodaje[clave]) usados.rodaje[clave] = 0;
                      const idx = (semana*4 + usados.rodaje[clave]) % opts.length;
                      detalle = { ...opts[idx], tipo:"rodaje" };
                      usados.rodaje[clave]++;
                      color = "sesion-rodaje"; breve = "R";
                    }
                  }
                }

                const div = document.createElement("div");
                div.className = `calendario-dia ${color}`;
                if (detalle) div.dataset.detalle = JSON.stringify(detalle);
                div.innerHTML = `<div style="font-size:10px;">S${semana+1}</div><strong>${breve}</strong>${detalle?`<div style="font-size:8px;">${detalle.duracion}${detalle.unidad}</div>`:''}`;
                div.dataset.letra = breve;
                div.dataset.semana = semana+1;
                div.dataset.colorClass = color;

                div.onclick = function() {
                  const modal = document.getElementById("detalleSesion"), overlay = document.getElementById("modalOverlay"), wrapper = document.getElementById("modalColorWrapper");
                  wrapper.className = "modal-content"; wrapper.classList.add(this.dataset.colorClass);
                  const det = this.dataset.detalle ? JSON.parse(this.dataset.detalle) : null;
                  AppState.currentSesionDetalle = det;
                  let tit = "", cont = "";
                  if (this.dataset.letra === "D") {
                    tit = "D√çA DE DESCANSO";
                    cont = "<strong>> OBJETIVO_</strong> Recuperaci√≥n completa<br><br><strong>> RECOMENDADO_</strong><br>‚Ä¢ No correr<br>‚Ä¢ Estiramientos suaves o yoga<br>‚Ä¢ Caminar<br><br><strong>> CLAVE_</strong><br>‚Ä¢ Dormir 7-9 horas<br>‚Ä¢ Buena nutrici√≥n<br>‚Ä¢ Escucha a tu cuerpo";
                  } else if (det) {
                    tit = det.nombre || `${this.dataset.letra} ¬∑ Semana ${this.dataset.semana}`;
                    const ritmo = PlanGenerator.getRitmoPorZona(det.zona);
                    cont = `<strong>üèÉ ${det.nombre}</strong><br><br><strong>‚è±Ô∏è DURACI√ìN:</strong> ${det.duracion} ${det.unidad}<br><strong>üìä ZONA:</strong> ${det.zona}<br><strong>‚ö° RITMO:</strong> ${ritmo}<br><br><strong>üìã ESTRUCTURA:</strong><br>${det.estructura}<br><br><strong>üí¨ DESCRIPCI√ìN:</strong><br>${det.desc}<br><br><strong>üòå SENSACI√ìN:</strong> ${det.sensacion}`;
                  } else {
                    cont = "> SELECCIONA UN D√çA PARA VER DETALLES_";
                  }
                  document.getElementById("tituloSesion").innerText = tit;
                  document.getElementById("descripcionSesion").innerHTML = cont;
                  modal.style.display = "block"; overlay.classList.add("visible");
                  setTimeout(() => modal.classList.add("visible"), 10);
                };
                fragment.appendChild(div);
              }
              grid.appendChild(fragment);
              AppState.planGeneradoActual = { modalidad, distancia, macrociclo, diasPorSemana:diasSem, nivel, experiencia:exp, objetivo:obj, diaLargo, fechaInicio };
              document.getElementById("calendarioEntreno").style.display = "block";
              document.getElementById("guardarPlanBtn").style.display = "block";
              if (btn) Utils.hideLoading(btn);
            } catch (e) { console.error(e); alert("> ERROR GENERANDO PLAN_"); if (btn) Utils.hideLoading(btn); }
          }, 300);
        }
      };

      // ==================== M√ìDULO PWA ====================
      const PWA = {
        init() {
          window.addEventListener('beforeinstallprompt', e => {
            e.preventDefault();
            AppState.deferredPrompt = e;
            if (localStorage.getItem('pwa_installed') !== 'true') document.getElementById('pwa-banner').style.display = 'flex';
          });
          window.addEventListener('appinstalled', () => {
            document.getElementById('pwa-banner').style.display = 'none';
            AppState.deferredPrompt = null;
            localStorage.setItem('pwa_installed', 'true');
          });
        },
        instalarPWA() {
          if (!AppState.deferredPrompt) { alert('Para instalar: men√∫ del navegador ‚Üí "A√±adir a pantalla de inicio"'); return; }
          AppState.deferredPrompt.prompt();
          AppState.deferredPrompt.userChoice.then(c => {
            if (c.outcome === 'accepted') localStorage.setItem('pwa_installed', 'true');
            AppState.deferredPrompt = null;
            document.getElementById('pwa-banner').style.display = 'none';
          });
        },
        cerrarBannerPWA() {
          document.getElementById('pwa-banner').style.display = 'none';
          localStorage.setItem('pwa_banner_closed', 'true');
        },
        registerServiceWorker() {
          if ('serviceWorker' in navigator) {
            const swCode = `const CACHE_NAME='ri5-cache-v1'; const urlsToCache=['.','https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js']; self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(urlsToCache)))}); self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))}); self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(ks=>Promise.all(ks.map(k=>k!==CACHE_NAME?caches.delete(k):null))))});`;
            const blob = new Blob([swCode], {type:'application/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(console.log);
          }
        }
      };

      // ==================== INICIALIZACI√ìN ====================
      document.addEventListener("DOMContentLoaded", async () => {
        if (!await Auth.checkSavedSession()) {
          document.getElementById("loginPage").style.display = "flex";
          document.getElementById("mainContent").style.display = "none";
        }
        document.getElementById("name").addEventListener("blur", () => UI.marcarCampoTocado('name'));
        document.getElementById("age").addEventListener("blur", () => UI.marcarCampoTocado('age'));
        document.getElementById("time").addEventListener("blur", () => UI.marcarCampoTocado('time'));
        document.getElementById("name").addEventListener("input", () => { if(AppState.camposTocados.name) UI.validarCampo('name'); UI.validarTodo(); });
        document.getElementById("age").addEventListener("input", () => { if(AppState.camposTocados.age) UI.validarCampo('age'); UI.validarTodo(); });
        document.getElementById("time").addEventListener("input", () => { if(AppState.camposTocados.time) UI.validarCampo('time'); UI.validarTodo(); });
        UI.validarTodo();
        if (localStorage.getItem('pwa_banner_closed')==='true' || localStorage.getItem('pwa_installed')==='true') document.getElementById('pwa-banner').style.display='none';
        PWA.init(); PWA.registerServiceWorker();
        setTimeout(() => { if (AppState.deferredPrompt && localStorage.getItem('pwa_installed')!=='true') document.getElementById('pwa-banner').style.display='flex'; }, 3000);
      });

      window.switchAuthTab = Auth.switchAuthTab.bind(Auth);
      window.solicitarCodigo = Auth.solicitarCodigo;
      window.registerUser = Auth.registerUser.bind(Auth);
      window.loginUser = Auth.loginUser.bind(Auth);
      window.logoutUser = Auth.logoutUser.bind(Auth);
      window.logoutAdmin = Auth.logoutAdmin.bind(Auth);
      window.checkPermisosPremium = Auth.checkPermisosPremium.bind(Auth);
      window.extenderUsuario = Admin.extenderUsuario.bind(Admin);
      window.eliminarUsuario = Admin.eliminarUsuario.bind(Admin);
      window.filtrarUsuarios = Admin.filtrarUsuarios.bind(Admin);
      window.exportarUsuariosCSV = Admin.exportarUsuariosCSV.bind(Admin);
      window.renovarExpirados = Admin.renovarExpirados.bind(Admin);
      window.toggleAllUsers = Admin.toggleAllUsers.bind(Admin);
      window.enviarMensaje = Admin.enviarMensaje.bind(Admin);
      window.startCalc = Training.startCalc.bind(Training);
      window.copyResults = Training.copyResults.bind(Training);
      window.guardarCalculo = Training.guardarCalculo.bind(Training);
      window.switchTab = UI.switchTab.bind(UI);
      window.changeDailyTip = UI.changeDailyTip.bind(UI);
      window.changeConsejo = UI.changeConsejo.bind(UI);
      window.borrarEntradaHistorial = UI.borrarEntradaHistorial.bind(UI);
      window.borrarHistorial = UI.borrarHistorial.bind(UI);
      window.cerrarModalSesion = UI.cerrarModalSesion.bind(UI);
      window.cerrarPlan = UI.cerrarPlan.bind(UI);
      window.toggleCuestionario = PlanGenerator.toggleCuestionario.bind(PlanGenerator);
      window.guardarPlanActual = PlanGenerator.guardarPlanActual.bind(PlanGenerator);
      window.mostrarUltimoPlanGuardado = PlanGenerator.mostrarUltimoPlanGuardado.bind(PlanGenerator);
      window.borrarPlanGuardado = PlanGenerator.borrarPlanGuardado.bind(PlanGenerator);
      window.generarCalendarioEntreno = PlanGenerator.generarCalendarioEntreno.bind(PlanGenerator);
      window.instalarPWA = PWA.instalarPWA.bind(PWA);
      window.cerrarBannerPWA = PWA.cerrarBannerPWA.bind(PWA);
    })();
  </script>
</body>
</html>